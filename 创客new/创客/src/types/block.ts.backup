// ç§¯æœ¨å—ç±»å‹å®šä¹‰

// ç§¯æœ¨å—åŸºç¡€ç±»å‹
export interface Block {
  id: string;
  type: BlockType;
  category: BlockCategory;
  name: string;
  inputs: BlockInput[];
  outputs?: BlockOutput[];
  next?: string; // ä¸‹ä¸€ä¸ªå—çš„ID
  parent?: string; // çˆ¶å—ID
  values: Record<string, unknown>;
}

// ç§¯æœ¨ç±»åˆ«
export type BlockCategory =
  | 'event'         // äº‹ä»¶è§¦å‘ - é»„è‰²
  | 'condition'     // æ¡ä»¶åˆ¤æ–­ - è“è‰²
  | 'action'        // åŠ¨ä½œæ‰§è¡Œ - ç»¿è‰²
  | 'data'          // æ•°æ®æ“ä½œ - æ©™è‰²
  | 'control'       // æ§åˆ¶æµç¨‹ - æ©™é»„è‰²
  | 'math'          // æ•°å­¦è¿ç®— - ç»¿è‰²
  | 'text'          // æ–‡æœ¬æ“ä½œ - é»„ç»¿è‰²
  | 'variable'      // å˜é‡ - æ©™è‰²
  | 'game_event'    // æ¸¸æˆäº‹ä»¶ - é‡‘è‰²
  | 'game_motion'   // æ¸¸æˆè¿åŠ¨ - å¤©è“è‰²
  | 'game_looks'    // æ¸¸æˆå¤–è§‚ - ç´«è‰²
  | 'game_sensing'  // æ¸¸æˆä¾¦æµ‹ - é’è“è‰²
  | 'game_state'    // æ¸¸æˆçŠ¶æ€ - ç²‰çº¢è‰²
  | 'game_clone'    // æ¸¸æˆå…‹éš† - ç²‰ç´«è‰²
  | 'game_sound'    // å£°éŸ³ - ç²‰è‰²
  | 'game_physics'  // ç‰©ç† - é’ç»¿è‰²
  | 'game_effect'   // ç‰¹æ•ˆ - ç´«çº¢è‰²
  | 'game_list'     // åˆ—è¡¨ - çº¢æ©™è‰²
  | 'game_camera';  // æ‘„åƒæœº - æ·±è“è‰²

// ç§¯æœ¨ç±»å‹
export type BlockType =
  // äº‹ä»¶ç±»
  | 'event_tap'
  | 'event_longpress'
  | 'event_input'
  | 'event_change'
  | 'event_load'
  | 'event_show'
  | 'event_hide'
  | 'event_scroll'
  // æ¡ä»¶ç±»
  | 'condition_if'
  | 'condition_ifelse'
  | 'condition_compare'
  | 'condition_and'
  | 'condition_or'
  | 'condition_not'
  // åŠ¨ä½œç±»
  | 'action_setdata'
  | 'action_navigate'
  | 'action_request'
  | 'action_toast'
  | 'action_modal'
  | 'action_loading'
  | 'action_storage'
  | 'action_playaudio'
  | 'action_vibrate'
  // æ•°æ®ç±»
  | 'data_variable'
  | 'data_getvalue'
  | 'data_setvalue'
  | 'data_array'
  | 'data_object'
  // æ§åˆ¶ç±»
  | 'control_wait'
  | 'control_repeat'
  | 'control_foreach'
  | 'control_stop'
  // æ•°å­¦ç±»
  | 'math_number'
  | 'math_arithmetic'
  | 'math_random'
  | 'math_round'
  | 'math_mod'
  | 'math_abs'
  | 'math_minmax'
  | 'math_sqrt'
  | 'math_power'
  | 'math_trig'
  | 'math_constrain'
  // æ–‡æœ¬ç±»
  | 'text_string'
  | 'text_join'
  | 'text_length'
  | 'text_contains'
  | 'text_letter'
  // æ¸¸æˆäº‹ä»¶ç±»
  | 'game_event_start'
  | 'game_event_update'
  | 'game_event_keydown'
  | 'game_event_keyup'
  | 'game_event_collision'
  | 'game_event_message'
  | 'game_event_clone'
  // æ¸¸æˆè¿åŠ¨ç±»
  | 'game_move'
  | 'game_moveto'
  | 'game_glide'
  | 'game_setvelocity'
  | 'game_rotate'
  | 'game_rotateto'
  | 'game_pointtowards'
  | 'game_bounce'
  // æ¸¸æˆå¤–è§‚ç±»
  | 'game_show'
  | 'game_hide'
  | 'game_setsize'
  | 'game_setscale'
  | 'game_setopacity'
  | 'game_nextcostume'
  | 'game_setcostume'
  // æ¸¸æˆä¾¦æµ‹ç±»
  | 'game_istouching'
  | 'game_istouchingcolor'
  | 'game_getposition'
  | 'game_getrotation'
  | 'game_distanceto'
  | 'game_keypressed'
  // æ¸¸æˆçŠ¶æ€ç±»
  | 'game_setscore'
  | 'game_addscore'
  | 'game_getscore'
  | 'game_setlives'
  | 'game_loselife'
  | 'game_getlives'
  | 'game_gotoscene'
  | 'game_restartgame'
  | 'game_gameover'
  // æ¸¸æˆå…‹éš†ç±»
  | 'game_clone'
  | 'game_cloneof'
  | 'game_destroy'
  | 'game_broadcast'
  | 'game_broadcastwait'
  // æ¸¸æˆå£°éŸ³ç±»
  | 'game_playsound'
  | 'game_playmusic'
  | 'game_stopsound'
  | 'game_stopallsound'
  | 'game_setvolume'
  | 'game_changevolume'
  // æ¸¸æˆç‰©ç†ç±»
  | 'game_setgravity'
  | 'game_setfriction'
  | 'game_setbounce'
  | 'game_applyforce'
  | 'game_setmass'
  | 'game_enablephysics'
  | 'game_place_invisible_platform'
  | 'game_remove_invisible_platform'
  // æ¸¸æˆç‰¹æ•ˆç±»
  | 'game_seteffect'
  | 'game_changeeffect'
  | 'game_cleareffects'
  | 'game_shake'
  | 'game_flash'
  | 'game_fadein'
  | 'game_fadeout'
  // æ¸¸æˆåˆ—è¡¨ç±»
  | 'game_createlist'
  | 'game_addtolist'
  | 'game_removefromlist'
  | 'game_getlistitem'
  | 'game_setlistitem'
  | 'game_listlength'
  | 'game_listcontains'
  // æ›´å¤šæ§åˆ¶ç±»
  | 'control_forever'
  | 'control_waituntil'
  | 'control_repeatuntil'
  // æ›´å¤šäº‹ä»¶ç±»
  | 'game_event_touch'
  | 'game_event_swipe'
  | 'game_event_timer'
  // è®¡æ—¶å™¨ç±»
  | 'game_resettimer'
  | 'game_gettimer'
  // æ‘„åƒæœºç±»
  | 'game_camera_follow'
  | 'game_set_scene_size'
  | 'game_set_background'
  | 'game_add_parallax_layer'
  | 'game_set_scroll_direction'
  | 'game_set_boundary_mode'
  | 'game_enable_drag';

// ç§¯æœ¨è¾“å…¥
export interface BlockInput {
  name: string;
  label: string;
  type: BlockInputType;
  defaultValue?: unknown;
  options?: { label: string; value: unknown }[];
  placeholder?: string;
  required?: boolean;
  blockId?: string; // å¦‚æœæ˜¯åµŒå¥—å—
}

export type BlockInputType =
  | 'string'
  | 'number'
  | 'boolean'
  | 'select'
  | 'variable'
  | 'expression'
  | 'block'  // å¯åµŒå¥—å—
  | 'component'; // ç»„ä»¶å¼•ç”¨

// ç§¯æœ¨è¾“å‡º
export interface BlockOutput {
  name: string;
  type: 'value' | 'boolean' | 'any';
}

// ç§¯æœ¨å®šä¹‰ï¼ˆç”¨äºç§¯æœ¨åº“ï¼‰
export interface BlockDefinition {
  type: BlockType;
  category: BlockCategory;
  name: string;
  description: string;
  icon?: string;
  color: string;
  inputs: Omit<BlockInput, 'blockId'>[];
  outputs?: BlockOutput[];
  canHaveNext: boolean; // æ˜¯å¦å¯ä»¥æœ‰ä¸‹ä¸€ä¸ªå—
  canBeNested: boolean; // æ˜¯å¦å¯ä»¥è¢«åµŒå¥—
  template: string; // æ˜¾ç¤ºæ¨¡æ¿
}

// ç§¯æœ¨è¿æ¥
export interface BlockConnection {
  fromBlockId: string;
  fromOutput?: string;
  toBlockId: string;
  toInput: string;
}

// äº‹ä»¶é€»è¾‘ç»„
export interface EventLogicGroup {
  id: string;
  componentId: string;
  trigger: string;
  blocks: Block[];
  connections: BlockConnection[];
  enabled: boolean;
}

// ç§¯æœ¨ç¼–è¾‘å™¨çŠ¶æ€
export interface BlockEditorState {
  selectedBlockId: string | null;
  draggingBlock: Block | null;
  clipboard: Block | null;
  zoom: number;
  panOffset: { x: number; y: number };
}

// é¢œè‰²é…ç½® - Scratch é£æ ¼æ¸¸æˆä¸»é¢˜
export const BLOCK_COLORS: Record<BlockCategory, string> = {
  event: '#FFBF00',        // é‡‘é»„è‰² - äº‹ä»¶è§¦å‘
  condition: '#5B80A5',    // é›è“è‰² - é€»è¾‘æ¡ä»¶
  action: '#59C059',       // ç¿ ç»¿è‰² - åŠ¨ä½œæ‰§è¡Œ
  data: '#FF8C1A',         // æ©™è‰² - æ•°æ®å˜é‡
  control: '#FFAB19',      // æ©™é»„è‰² - æ§åˆ¶æµç¨‹
  math: '#40BF4A',         // æ·±ç»¿è‰² - æ•°å­¦è¿ç®—
  text: '#5CB712',         // é»„ç»¿è‰² - æ–‡æœ¬æ“ä½œ
  variable: '#FF8C1A',     // æ©™è‰² - å˜é‡
  game_event: '#FFBF00',   // é‡‘é»„è‰² - æ¸¸æˆäº‹ä»¶
  game_motion: '#4C97FF',  // å¤©è“è‰² - è¿åŠ¨
  game_looks: '#9966FF',   // ç´«è‰² - å¤–è§‚
  game_sensing: '#5CB1D6', // é’è“è‰² - ä¾¦æµ‹
  game_state: '#FF6680',   // ç²‰çº¢è‰² - æ¸¸æˆçŠ¶æ€
  game_clone: '#CF63CF',   // ç²‰ç´«è‰² - å…‹éš†/æ¶ˆæ¯
  game_sound: '#D65CD6',   // ç²‰è‰² - å£°éŸ³
  game_physics: '#4CBFE6', // é’ç»¿è‰² - ç‰©ç†
  game_effect: '#9933FF',  // ç´«çº¢è‰² - ç‰¹æ•ˆ
  game_list: '#FF661A',    // çº¢æ©™è‰² - åˆ—è¡¨
  game_camera: '#1E90FF',  // æ·±è“è‰² - æ‘„åƒæœº
};

// ç§¯æœ¨åº“å®šä¹‰
export const BLOCK_DEFINITIONS: BlockDefinition[] = [
  // äº‹ä»¶ç±»
  {
    type: 'event_tap',
    category: 'event',
    name: 'å½“ç‚¹å‡»æ—¶',
    description: 'å½“ç”¨æˆ·ç‚¹å‡»ç»„ä»¶æ—¶è§¦å‘',
    color: BLOCK_COLORS.event,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ–±ï¸ å½“ç‚¹å‡»æ—¶',
  },
  {
    type: 'event_longpress',
    category: 'event',
    name: 'å½“é•¿æŒ‰æ—¶',
    description: 'å½“ç”¨æˆ·é•¿æŒ‰ç»„ä»¶æ—¶è§¦å‘',
    color: BLOCK_COLORS.event,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ‘† å½“é•¿æŒ‰æ—¶',
  },
  {
    type: 'event_input',
    category: 'event',
    name: 'å½“è¾“å…¥æ—¶',
    description: 'å½“ç”¨æˆ·è¾“å…¥å†…å®¹æ—¶è§¦å‘',
    color: BLOCK_COLORS.event,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'âŒ¨ï¸ å½“è¾“å…¥æ—¶',
  },
  {
    type: 'event_change',
    category: 'event',
    name: 'å½“å€¼æ”¹å˜æ—¶',
    description: 'å½“ç»„ä»¶å€¼æ”¹å˜æ—¶è§¦å‘',
    color: BLOCK_COLORS.event,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”„ å½“å€¼æ”¹å˜æ—¶',
  },
  {
    type: 'event_load',
    category: 'event',
    name: 'å½“é¡µé¢åŠ è½½æ—¶',
    description: 'é¡µé¢åŠ è½½å®Œæˆæ—¶è§¦å‘',
    color: BLOCK_COLORS.event,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“„ å½“é¡µé¢åŠ è½½æ—¶',
  },
  {
    type: 'event_show',
    category: 'event',
    name: 'å½“é¡µé¢æ˜¾ç¤ºæ—¶',
    description: 'é¡µé¢æ˜¾ç¤ºæ—¶è§¦å‘',
    color: BLOCK_COLORS.event,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ‘ï¸ å½“é¡µé¢æ˜¾ç¤ºæ—¶',
  },

  // æ¡ä»¶ç±» - é€»è¾‘è¿ç®—
  {
    type: 'condition_if',
    category: 'condition',
    name: 'å¦‚æœ...é‚£ä¹ˆ',
    description: 'æ¡ä»¶åˆ¤æ–­ï¼Œæ»¡è¶³æ¡ä»¶åˆ™æ‰§è¡Œ',
    color: BLOCK_COLORS.condition,
    inputs: [
      { name: 'condition', label: 'æ¡ä»¶', type: 'expression', required: true, placeholder: 'æ¡ä»¶' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”€ å¦‚æœ {condition} é‚£ä¹ˆ',
  },
  {
    type: 'condition_ifelse',
    category: 'condition',
    name: 'å¦‚æœ...å¦åˆ™',
    description: 'æ¡ä»¶åˆ¤æ–­ï¼Œå«å¦åˆ™åˆ†æ”¯',
    color: BLOCK_COLORS.condition,
    inputs: [
      { name: 'condition', label: 'æ¡ä»¶', type: 'expression', required: true, placeholder: 'æ¡ä»¶' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”€ å¦‚æœ {condition} é‚£ä¹ˆ...å¦åˆ™...',
  },
  {
    type: 'condition_compare',
    category: 'condition',
    name: 'æ¯”è¾ƒ',
    description: 'æ¯”è¾ƒä¸¤ä¸ªå€¼çš„å¤§å°å…³ç³»',
    color: BLOCK_COLORS.condition,
    inputs: [
      { name: 'left', label: 'å·¦å€¼', type: 'expression', required: true, placeholder: 'å€¼1' },
      { name: 'operator', label: 'è¿ç®—ç¬¦', type: 'select', defaultValue: '==', options: [
        { label: '=', value: '==' },
        { label: 'â‰ ', value: '!=' },
        { label: '>', value: '>' },
        { label: '<', value: '<' },
        { label: 'â‰¥', value: '>=' },
        { label: 'â‰¤', value: '<=' },
      ]},
      { name: 'right', label: 'å³å€¼', type: 'expression', required: true, placeholder: 'å€¼2' },
    ],
    outputs: [{ name: 'result', type: 'boolean' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‡ {left} {operator} {right}',
  },
  {
    type: 'condition_and',
    category: 'condition',
    name: 'ä¸',
    description: 'ä¸¤ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³',
    color: BLOCK_COLORS.condition,
    inputs: [
      { name: 'left', label: 'æ¡ä»¶1', type: 'expression', required: true, placeholder: 'æ¡ä»¶1' },
      { name: 'right', label: 'æ¡ä»¶2', type: 'expression', required: true, placeholder: 'æ¡ä»¶2' },
    ],
    outputs: [{ name: 'result', type: 'boolean' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‡ {left} ä¸ {right}',
  },
  {
    type: 'condition_or',
    category: 'condition',
    name: 'æˆ–',
    description: 'æ»¡è¶³ä»»ä¸€æ¡ä»¶å³å¯',
    color: BLOCK_COLORS.condition,
    inputs: [
      { name: 'left', label: 'æ¡ä»¶1', type: 'expression', required: true, placeholder: 'æ¡ä»¶1' },
      { name: 'right', label: 'æ¡ä»¶2', type: 'expression', required: true, placeholder: 'æ¡ä»¶2' },
    ],
    outputs: [{ name: 'result', type: 'boolean' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‡ {left} æˆ– {right}',
  },
  {
    type: 'condition_not',
    category: 'condition',
    name: 'é',
    description: 'æ¡ä»¶å–å',
    color: BLOCK_COLORS.condition,
    inputs: [
      { name: 'condition', label: 'æ¡ä»¶', type: 'expression', required: true, placeholder: 'æ¡ä»¶' },
    ],
    outputs: [{ name: 'result', type: 'boolean' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‡ ä¸æ»¡è¶³ {condition}',
  },

  // åŠ¨ä½œç±»
  {
    type: 'action_setdata',
    category: 'action',
    name: 'è®¾ç½®æ•°æ®',
    description: 'è®¾ç½®é¡µé¢æ•°æ®',
    color: BLOCK_COLORS.action,
    inputs: [
      { name: 'key', label: 'æ•°æ®å', type: 'string', required: true, placeholder: 'è¾“å…¥æ•°æ®å' },
      { name: 'value', label: 'å€¼', type: 'expression', required: true, placeholder: 'è¾“å…¥å€¼æˆ–è¡¨è¾¾å¼' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“ è®¾ç½® {key} ä¸º {value}',
  },
  {
    type: 'action_navigate',
    category: 'action',
    name: 'è·³è½¬é¡µé¢',
    description: 'è·³è½¬åˆ°æŒ‡å®šé¡µé¢',
    color: BLOCK_COLORS.action,
    inputs: [
      { name: 'url', label: 'é¡µé¢è·¯å¾„', type: 'string', required: true, placeholder: '/pages/xxx/xxx' },
      { name: 'type', label: 'è·³è½¬æ–¹å¼', type: 'select', defaultValue: 'navigateTo', options: [
        { label: 'è·³è½¬', value: 'navigateTo' },
        { label: 'é‡å®šå‘', value: 'redirectTo' },
        { label: 'åˆ‡æ¢Tab', value: 'switchTab' },
        { label: 'è¿”å›', value: 'navigateBack' },
        { label: 'é‡å¯', value: 'reLaunch' },
      ]},
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”— {type} åˆ° {url}',
  },
  {
    type: 'action_toast',
    category: 'action',
    name: 'æ˜¾ç¤ºæç¤º',
    description: 'æ˜¾ç¤ºè½»æç¤º',
    color: BLOCK_COLORS.action,
    inputs: [
      { name: 'title', label: 'æç¤ºå†…å®¹', type: 'string', required: true, placeholder: 'æç¤ºæ–‡å­—' },
      { name: 'icon', label: 'å›¾æ ‡', type: 'select', defaultValue: 'none', options: [
        { label: 'æ— ', value: 'none' },
        { label: 'æˆåŠŸ', value: 'success' },
        { label: 'åŠ è½½', value: 'loading' },
        { label: 'é”™è¯¯', value: 'error' },
      ]},
      { name: 'duration', label: 'æŒç»­æ—¶é—´(ms)', type: 'number', defaultValue: 1500 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ’¬ æç¤º "{title}"',
  },
  {
    type: 'action_modal',
    category: 'action',
    name: 'æ˜¾ç¤ºå¼¹çª—',
    description: 'æ˜¾ç¤ºæ¨¡æ€å¼¹çª—',
    color: BLOCK_COLORS.action,
    inputs: [
      { name: 'title', label: 'æ ‡é¢˜', type: 'string', required: true },
      { name: 'content', label: 'å†…å®¹', type: 'string', required: true },
      { name: 'showCancel', label: 'æ˜¾ç¤ºå–æ¶ˆæŒ‰é’®', type: 'boolean', defaultValue: true },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“¢ å¼¹çª— "{title}"',
  },
  {
    type: 'action_loading',
    category: 'action',
    name: 'æ˜¾ç¤ºåŠ è½½',
    description: 'æ˜¾ç¤º/éšè—åŠ è½½æç¤º',
    color: BLOCK_COLORS.action,
    inputs: [
      { name: 'show', label: 'æ˜¾ç¤º/éšè—', type: 'boolean', defaultValue: true },
      { name: 'title', label: 'æç¤ºæ–‡å­—', type: 'string', defaultValue: 'åŠ è½½ä¸­...' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â³ {show} åŠ è½½ "{title}"',
  },
  {
    type: 'action_request',
    category: 'action',
    name: 'å‘é€è¯·æ±‚',
    description: 'å‘é€ç½‘ç»œè¯·æ±‚',
    color: BLOCK_COLORS.action,
    inputs: [
      { name: 'url', label: 'URL', type: 'string', required: true },
      { name: 'method', label: 'æ–¹æ³•', type: 'select', defaultValue: 'GET', options: [
        { label: 'GET', value: 'GET' },
        { label: 'POST', value: 'POST' },
        { label: 'PUT', value: 'PUT' },
        { label: 'DELETE', value: 'DELETE' },
      ]},
      { name: 'data', label: 'è¯·æ±‚æ•°æ®', type: 'expression' },
      { name: 'resultVar', label: 'ç»“æœå­˜å…¥å˜é‡', type: 'string' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸŒ è¯·æ±‚ {method} {url}',
  },
  {
    type: 'action_storage',
    category: 'action',
    name: 'æœ¬åœ°å­˜å‚¨',
    description: 'è¯»å†™æœ¬åœ°å­˜å‚¨',
    color: BLOCK_COLORS.action,
    inputs: [
      { name: 'action', label: 'æ“ä½œ', type: 'select', defaultValue: 'set', options: [
        { label: 'ä¿å­˜', value: 'set' },
        { label: 'è¯»å–', value: 'get' },
        { label: 'åˆ é™¤', value: 'remove' },
      ]},
      { name: 'key', label: 'é”®å', type: 'string', required: true },
      { name: 'value', label: 'å€¼', type: 'expression' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ’¾ {action} å­˜å‚¨ "{key}"',
  },

  // æ§åˆ¶ç±»
  {
    type: 'control_wait',
    category: 'control',
    name: 'ç­‰å¾…',
    description: 'ç­‰å¾…æŒ‡å®šæ—¶é—´',
    color: BLOCK_COLORS.control,
    inputs: [
      { name: 'duration', label: 'æ—¶é—´(ç§’)', type: 'number', defaultValue: 1 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â±ï¸ ç­‰å¾… {duration} ç§’',
  },
  {
    type: 'control_repeat',
    category: 'control',
    name: 'é‡å¤',
    description: 'é‡å¤æ‰§è¡ŒæŒ‡å®šæ¬¡æ•°',
    color: BLOCK_COLORS.control,
    inputs: [
      { name: 'times', label: 'æ¬¡æ•°', type: 'number', defaultValue: 10 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ” é‡å¤ {times} æ¬¡',
  },
  {
    type: 'control_foreach',
    category: 'control',
    name: 'éå†',
    description: 'éå†åˆ—è¡¨ä¸­çš„æ¯ä¸€é¡¹',
    color: BLOCK_COLORS.control,
    inputs: [
      { name: 'list', label: 'åˆ—è¡¨', type: 'expression', required: true },
      { name: 'itemVar', label: 'é¡¹å˜é‡å', type: 'string', defaultValue: 'item' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“‹ éå† {list} ä¸­çš„æ¯ä¸ª {itemVar}',
  },
  {
    type: 'control_stop',
    category: 'control',
    name: 'åœæ­¢',
    description: 'åœæ­¢å½“å‰é€»è¾‘æ‰§è¡Œ',
    color: BLOCK_COLORS.control,
    inputs: [],
    canHaveNext: false,
    canBeNested: false,
    template: 'â›” åœæ­¢æ‰§è¡Œ',
  },

  // æ•°æ®ç±»
  {
    type: 'data_variable',
    category: 'data',
    name: 'å˜é‡',
    description: 'å¼•ç”¨å˜é‡å€¼',
    color: BLOCK_COLORS.data,
    inputs: [
      { name: 'name', label: 'å˜é‡å', type: 'variable', required: true },
    ],
    outputs: [{ name: 'value', type: 'any' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'ğŸ“Œ {name}',
  },
  {
    type: 'data_setvalue',
    category: 'data',
    name: 'è®¾ç½®å˜é‡',
    description: 'è®¾ç½®å˜é‡çš„å€¼',
    color: BLOCK_COLORS.data,
    inputs: [
      { name: 'name', label: 'å˜é‡å', type: 'variable', required: true },
      { name: 'value', label: 'å€¼', type: 'expression', required: true },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“Œ è®¾ç½® {name} = {value}',
  },

  // æ•°å­¦ç±» - è¿ç®—ç§¯æœ¨
  {
    type: 'math_number',
    category: 'math',
    name: 'æ•°å­—',
    description: 'æ•°å­—å€¼',
    color: BLOCK_COLORS.math,
    inputs: [
      { name: 'value', label: 'æ•°å€¼', type: 'number', defaultValue: 0 },
    ],
    outputs: [{ name: 'value', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ {value}',
  },
  {
    type: 'math_arithmetic',
    category: 'math',
    name: 'å››åˆ™è¿ç®—',
    description: 'åŠ å‡ä¹˜é™¤è¿ç®—',
    color: BLOCK_COLORS.math,
    inputs: [
      { name: 'left', label: 'å·¦å€¼', type: 'expression', required: true, placeholder: 'æ•°å€¼' },
      { name: 'operator', label: 'è¿ç®—ç¬¦', type: 'select', defaultValue: '+', options: [
        { label: '+', value: '+' },
        { label: '-', value: '-' },
        { label: 'Ã—', value: '*' },
        { label: 'Ã·', value: '/' },
      ]},
      { name: 'right', label: 'å³å€¼', type: 'expression', required: true, placeholder: 'æ•°å€¼' },
    ],
    outputs: [{ name: 'result', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ {left} {operator} {right}',
  },
  {
    type: 'math_random',
    category: 'math',
    name: 'éšæœºæ•°',
    description: 'ç”ŸæˆæŒ‡å®šèŒƒå›´çš„éšæœºæ•´æ•°',
    color: BLOCK_COLORS.math,
    inputs: [
      { name: 'min', label: 'æœ€å°å€¼', type: 'number', defaultValue: 1 },
      { name: 'max', label: 'æœ€å¤§å€¼', type: 'number', defaultValue: 10 },
    ],
    outputs: [{ name: 'result', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ åœ¨ {min} å’Œ {max} ä¹‹é—´å–éšæœºæ•°',
  },
  {
    type: 'math_round',
    category: 'math',
    name: 'å–æ•´',
    description: 'å¯¹æ•°å­—è¿›è¡Œå–æ•´æ“ä½œ',
    color: BLOCK_COLORS.math,
    inputs: [
      { name: 'mode', label: 'æ–¹å¼', type: 'select', defaultValue: 'round', options: [
        { label: 'å››èˆäº”å…¥', value: 'round' },
        { label: 'å‘ä¸‹å–æ•´', value: 'floor' },
        { label: 'å‘ä¸Šå–æ•´', value: 'ceil' },
      ]},
      { name: 'value', label: 'æ•°å€¼', type: 'expression', required: true, placeholder: 'æ•°å€¼' },
    ],
    outputs: [{ name: 'result', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ {mode} {value}',
  },
  {
    type: 'math_mod',
    category: 'math',
    name: 'å–ä½™',
    description: 'æ±‚ä¸¤æ•°ç›¸é™¤çš„ä½™æ•°',
    color: BLOCK_COLORS.math,
    inputs: [
      { name: 'left', label: 'è¢«é™¤æ•°', type: 'expression', required: true, placeholder: 'æ•°å€¼' },
      { name: 'right', label: 'é™¤æ•°', type: 'expression', required: true, placeholder: 'æ•°å€¼' },
    ],
    outputs: [{ name: 'result', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ {left} é™¤ä»¥ {right} çš„ä½™æ•°',
  },
  {
    type: 'math_abs',
    category: 'math',
    name: 'ç»å¯¹å€¼',
    description: 'å–æ•°å­—çš„ç»å¯¹å€¼',
    color: BLOCK_COLORS.math,
    inputs: [
      { name: 'value', label: 'æ•°å€¼', type: 'expression', required: true, placeholder: 'æ•°å€¼' },
    ],
    outputs: [{ name: 'result', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ {value} çš„ç»å¯¹å€¼',
  },
  {
    type: 'math_minmax',
    category: 'math',
    name: 'æœ€å€¼',
    description: 'å–ä¸¤æ•°ä¸­çš„æœ€å¤§æˆ–æœ€å°å€¼',
    color: BLOCK_COLORS.math,
    inputs: [
      { name: 'mode', label: 'ç±»å‹', type: 'select', defaultValue: 'max', options: [
        { label: 'æœ€å¤§å€¼', value: 'max' },
        { label: 'æœ€å°å€¼', value: 'min' },
      ]},
      { name: 'a', label: 'æ•°å€¼1', type: 'expression', required: true, placeholder: 'æ•°å€¼' },
      { name: 'b', label: 'æ•°å€¼2', type: 'expression', required: true, placeholder: 'æ•°å€¼' },
    ],
    outputs: [{ name: 'result', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ {a} å’Œ {b} ä¸­çš„{mode}',
  },
  {
    type: 'math_sqrt',
    category: 'math',
    name: 'å¹³æ–¹æ ¹',
    description: 'è®¡ç®—å¹³æ–¹æ ¹',
    color: BLOCK_COLORS.math,
    inputs: [
      { name: 'value', label: 'æ•°å€¼', type: 'expression', required: true, placeholder: 'æ•°å€¼' },
    ],
    outputs: [{ name: 'result', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ {value} çš„å¹³æ–¹æ ¹',
  },
  {
    type: 'math_power',
    category: 'math',
    name: 'å¹‚è¿ç®—',
    description: 'è®¡ç®—å¹‚æ¬¡æ–¹',
    color: BLOCK_COLORS.math,
    inputs: [
      { name: 'base', label: 'åº•æ•°', type: 'expression', required: true, placeholder: 'åº•æ•°' },
      { name: 'exponent', label: 'æŒ‡æ•°', type: 'expression', required: true, placeholder: 'æŒ‡æ•°' },
    ],
    outputs: [{ name: 'result', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ {base} çš„ {exponent} æ¬¡æ–¹',
  },
  {
    type: 'math_trig',
    category: 'math',
    name: 'ä¸‰è§’å‡½æ•°',
    description: 'è®¡ç®—ä¸‰è§’å‡½æ•°å€¼',
    color: BLOCK_COLORS.math,
    inputs: [
      { name: 'func', label: 'å‡½æ•°', type: 'select', defaultValue: 'sin', options: [
        { label: 'sin æ­£å¼¦', value: 'sin' },
        { label: 'cos ä½™å¼¦', value: 'cos' },
        { label: 'tan æ­£åˆ‡', value: 'tan' },
        { label: 'asin åæ­£å¼¦', value: 'asin' },
        { label: 'acos åä½™å¼¦', value: 'acos' },
        { label: 'atan åæ­£åˆ‡', value: 'atan' },
      ]},
      { name: 'value', label: 'è§’åº¦', type: 'expression', required: true, placeholder: 'è§’åº¦' },
    ],
    outputs: [{ name: 'result', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ {func} {value}',
  },
  {
    type: 'math_constrain',
    category: 'math',
    name: 'é™åˆ¶èŒƒå›´',
    description: 'å°†æ•°å€¼é™åˆ¶åœ¨æŒ‡å®šèŒƒå›´å†…',
    color: BLOCK_COLORS.math,
    inputs: [
      { name: 'value', label: 'æ•°å€¼', type: 'expression', required: true, placeholder: 'æ•°å€¼' },
      { name: 'min', label: 'æœ€å°å€¼', type: 'number', defaultValue: 0 },
      { name: 'max', label: 'æœ€å¤§å€¼', type: 'number', defaultValue: 100 },
    ],
    outputs: [{ name: 'result', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ å°† {value} é™åˆ¶åœ¨ {min} åˆ° {max}',
  },

  // æ–‡æœ¬ç±»
  {
    type: 'text_string',
    category: 'text',
    name: 'æ–‡æœ¬',
    description: 'æ–‡æœ¬å€¼',
    color: BLOCK_COLORS.text,
    inputs: [
      { name: 'value', label: 'æ–‡æœ¬', type: 'string', defaultValue: '', placeholder: 'è¾“å…¥æ–‡æœ¬' },
    ],
    outputs: [{ name: 'value', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ "{value}"',
  },
  {
    type: 'text_join',
    category: 'text',
    name: 'è¿æ¥',
    description: 'è¿æ¥å¤šä¸ªæ–‡æœ¬',
    color: BLOCK_COLORS.text,
    inputs: [
      { name: 'text1', label: 'æ–‡æœ¬1', type: 'expression', required: true, placeholder: 'æ–‡æœ¬' },
      { name: 'text2', label: 'æ–‡æœ¬2', type: 'expression', required: true, placeholder: 'æ–‡æœ¬' },
    ],
    outputs: [{ name: 'result', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ è¿æ¥ {text1} å’Œ {text2}',
  },
  {
    type: 'text_length',
    category: 'text',
    name: 'é•¿åº¦',
    description: 'è·å–æ–‡æœ¬é•¿åº¦',
    color: BLOCK_COLORS.text,
    inputs: [
      { name: 'text', label: 'æ–‡æœ¬', type: 'expression', required: true, placeholder: 'æ–‡æœ¬' },
    ],
    outputs: [{ name: 'length', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ {text} çš„å­—ç¬¦æ•°',
  },
  {
    type: 'text_contains',
    category: 'text',
    name: 'åŒ…å«',
    description: 'æ£€æµ‹æ–‡æœ¬æ˜¯å¦åŒ…å«æŒ‡å®šå†…å®¹',
    color: BLOCK_COLORS.text,
    inputs: [
      { name: 'text', label: 'æ–‡æœ¬', type: 'expression', required: true, placeholder: 'æ–‡æœ¬' },
      { name: 'search', label: 'æŸ¥æ‰¾', type: 'expression', required: true, placeholder: 'æŸ¥æ‰¾å†…å®¹' },
    ],
    outputs: [{ name: 'result', type: 'boolean' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‡ {text} åŒ…å« {search}?',
  },
  {
    type: 'text_letter',
    category: 'text',
    name: 'ç¬¬Nä¸ªå­—ç¬¦',
    description: 'è·å–æ–‡æœ¬ä¸­æŒ‡å®šä½ç½®çš„å­—ç¬¦',
    color: BLOCK_COLORS.text,
    inputs: [
      { name: 'index', label: 'ç¬¬', type: 'number', defaultValue: 1 },
      { name: 'text', label: 'å­—ç¬¦', type: 'expression', required: true, placeholder: 'æ–‡æœ¬' },
    ],
    outputs: [{ name: 'letter', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ {text} çš„ç¬¬ {index} ä¸ªå­—ç¬¦',
  },

  // ========== æ¸¸æˆäº‹ä»¶ç±» ==========
  {
    type: 'game_event_start',
    category: 'game_event',
    name: 'å½“æ¸¸æˆå¼€å§‹',
    description: 'æ¸¸æˆå¼€å§‹æ—¶æ‰§è¡Œ',
    color: BLOCK_COLORS.game_event,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ® å½“æ¸¸æˆå¼€å§‹',
  },
  {
    type: 'game_event_update',
    category: 'game_event',
    name: 'æ¯å¸§æ‰§è¡Œ',
    description: 'æ¯ä¸€å¸§éƒ½æ‰§è¡Œ',
    color: BLOCK_COLORS.game_event,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”„ æ¯å¸§æ‰§è¡Œ',
  },
  {
    type: 'game_event_keydown',
    category: 'game_event',
    name: 'å½“æŒ‰ä¸‹æŒ‰é”®',
    description: 'å½“æŒ‰ä¸‹æŒ‡å®šæŒ‰é”®æ—¶æ‰§è¡Œ',
    color: BLOCK_COLORS.game_event,
    inputs: [
      { name: 'key', label: 'æŒ‰é”®', type: 'select', defaultValue: 'any', options: [
        { label: 'ä»»æ„é”®', value: 'any' },
        { label: 'â†‘ ä¸Š', value: 'ArrowUp' },
        { label: 'â†“ ä¸‹', value: 'ArrowDown' },
        { label: 'â† å·¦', value: 'ArrowLeft' },
        { label: 'â†’ å³', value: 'ArrowRight' },
        { label: 'ç©ºæ ¼', value: 'Space' },
        { label: 'W', value: 'KeyW' },
        { label: 'A', value: 'KeyA' },
        { label: 'S', value: 'KeyS' },
        { label: 'D', value: 'KeyD' },
      ]},
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'âŒ¨ï¸ å½“æŒ‰ä¸‹ {key}',
  },
  {
    type: 'game_event_collision',
    category: 'game_event',
    name: 'å½“ç¢°æ’åˆ°',
    description: 'å½“ç¢°æ’åˆ°æŒ‡å®šæ ‡ç­¾çš„å¯¹è±¡æ—¶æ‰§è¡Œ',
    color: BLOCK_COLORS.game_event,
    inputs: [
      { name: 'tag', label: 'æ ‡ç­¾', type: 'string', defaultValue: '', placeholder: 'è¾“å…¥æ ‡ç­¾' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ’¥ å½“ç¢°æ’åˆ° {tag}',
  },
  {
    type: 'game_event_message',
    category: 'game_event',
    name: 'å½“æ”¶åˆ°æ¶ˆæ¯',
    description: 'å½“æ”¶åˆ°æŒ‡å®šæ¶ˆæ¯æ—¶æ‰§è¡Œ',
    color: BLOCK_COLORS.game_event,
    inputs: [
      { name: 'message', label: 'æ¶ˆæ¯', type: 'string', defaultValue: '', placeholder: 'è¾“å…¥æ¶ˆæ¯å' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“¨ å½“æ”¶åˆ°æ¶ˆæ¯ {message}',
  },
  {
    type: 'game_event_clone',
    category: 'game_event',
    name: 'å½“è¢«å…‹éš†æ—¶',
    description: 'ä½œä¸ºå…‹éš†ä½“å¯åŠ¨æ—¶æ‰§è¡Œ',
    color: BLOCK_COLORS.game_event,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“‹ å½“è¢«å…‹éš†æ—¶',
  },

  // ========== æ¸¸æˆè¿åŠ¨ç±» ==========
  {
    type: 'game_move',
    category: 'game_motion',
    name: 'ç§»åŠ¨',
    description: 'ç›¸å¯¹ç§»åŠ¨æŒ‡å®šè·ç¦»',
    color: BLOCK_COLORS.game_motion,
    inputs: [
      { name: 'x', label: 'Xè·ç¦»', type: 'number', defaultValue: 10 },
      { name: 'y', label: 'Yè·ç¦»', type: 'number', defaultValue: 0 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â¡ï¸ ç§»åŠ¨ X:{x} Y:{y}',
  },
  {
    type: 'game_moveto',
    category: 'game_motion',
    name: 'ç§»åŠ¨åˆ°',
    description: 'ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®',
    color: BLOCK_COLORS.game_motion,
    inputs: [
      { name: 'x', label: 'Xä½ç½®', type: 'number', defaultValue: 0 },
      { name: 'y', label: 'Yä½ç½®', type: 'number', defaultValue: 0 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“ ç§»åŠ¨åˆ° ({x}, {y})',
  },
  {
    type: 'game_glide',
    category: 'game_motion',
    name: 'æ»‘åŠ¨åˆ°',
    description: 'åœ¨æŒ‡å®šæ—¶é—´å†…æ»‘åŠ¨åˆ°ç›®æ ‡ä½ç½®',
    color: BLOCK_COLORS.game_motion,
    inputs: [
      { name: 'x', label: 'Xä½ç½®', type: 'number', defaultValue: 0 },
      { name: 'y', label: 'Yä½ç½®', type: 'number', defaultValue: 0 },
      { name: 'duration', label: 'æ—¶é—´(ç§’)', type: 'number', defaultValue: 1 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ¯ åœ¨ {duration} ç§’å†…æ»‘åŠ¨åˆ° ({x}, {y})',
  },
  {
    type: 'game_setvelocity',
    category: 'game_motion',
    name: 'è®¾ç½®é€Ÿåº¦',
    description: 'è®¾ç½®ç§»åŠ¨é€Ÿåº¦',
    color: BLOCK_COLORS.game_motion,
    inputs: [
      { name: 'vx', label: 'Xé€Ÿåº¦', type: 'number', defaultValue: 0 },
      { name: 'vy', label: 'Yé€Ÿåº¦', type: 'number', defaultValue: 0 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ’¨ è®¾ç½®é€Ÿåº¦ ({vx}, {vy})',
  },
  {
    type: 'game_rotate',
    category: 'game_motion',
    name: 'æ—‹è½¬',
    description: 'æ—‹è½¬æŒ‡å®šè§’åº¦',
    color: BLOCK_COLORS.game_motion,
    inputs: [
      { name: 'angle', label: 'è§’åº¦', type: 'number', defaultValue: 15 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”„ æ—‹è½¬ {angle} åº¦',
  },
  {
    type: 'game_rotateto',
    category: 'game_motion',
    name: 'æ—‹è½¬åˆ°',
    description: 'æ—‹è½¬åˆ°æŒ‡å®šè§’åº¦',
    color: BLOCK_COLORS.game_motion,
    inputs: [
      { name: 'angle', label: 'è§’åº¦', type: 'number', defaultValue: 0 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ¯ æ—‹è½¬åˆ° {angle} åº¦',
  },
  {
    type: 'game_pointtowards',
    category: 'game_motion',
    name: 'é¢å‘',
    description: 'é¢å‘æŒ‡å®šä½ç½®',
    color: BLOCK_COLORS.game_motion,
    inputs: [
      { name: 'x', label: 'Xä½ç½®', type: 'number', defaultValue: 0 },
      { name: 'y', label: 'Yä½ç½®', type: 'number', defaultValue: 0 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ‘ï¸ é¢å‘ ({x}, {y})',
  },
  {
    type: 'game_bounce',
    category: 'game_motion',
    name: 'ç¢°åˆ°è¾¹ç¼˜åå¼¹',
    description: 'ç¢°åˆ°è¾¹ç¼˜æ—¶åå¼¹',
    color: BLOCK_COLORS.game_motion,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“ ç¢°åˆ°è¾¹ç¼˜åå¼¹',
  },

  // ========== æ¸¸æˆå¤–è§‚ç±» ==========
  {
    type: 'game_show',
    category: 'game_looks',
    name: 'æ˜¾ç¤º',
    description: 'æ˜¾ç¤ºè§’è‰²',
    color: BLOCK_COLORS.game_looks,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ‘ï¸ æ˜¾ç¤º',
  },
  {
    type: 'game_hide',
    category: 'game_looks',
    name: 'éšè—',
    description: 'éšè—è§’è‰²',
    color: BLOCK_COLORS.game_looks,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ™ˆ éšè—',
  },
  {
    type: 'game_setsize',
    category: 'game_looks',
    name: 'è®¾ç½®å¤§å°',
    description: 'è®¾ç½®è§’è‰²å¤§å°',
    color: BLOCK_COLORS.game_looks,
    inputs: [
      { name: 'width', label: 'å®½åº¦', type: 'number', defaultValue: 100 },
      { name: 'height', label: 'é«˜åº¦', type: 'number', defaultValue: 100 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“ è®¾ç½®å¤§å°ä¸º {width}Ã—{height}',
  },
  {
    type: 'game_setscale',
    category: 'game_looks',
    name: 'è®¾ç½®ç¼©æ”¾',
    description: 'è®¾ç½®ç¼©æ”¾æ¯”ä¾‹',
    color: BLOCK_COLORS.game_looks,
    inputs: [
      { name: 'scale', label: 'ç¼©æ”¾%', type: 'number', defaultValue: 100 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ” è®¾ç½®ç¼©æ”¾ä¸º {scale}%',
  },
  {
    type: 'game_setopacity',
    category: 'game_looks',
    name: 'è®¾ç½®é€æ˜åº¦',
    description: 'è®¾ç½®é€æ˜åº¦',
    color: BLOCK_COLORS.game_looks,
    inputs: [
      { name: 'opacity', label: 'é€æ˜åº¦%', type: 'number', defaultValue: 100 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ’§ è®¾ç½®é€æ˜åº¦ä¸º {opacity}%',
  },
  {
    type: 'game_setcostume',
    category: 'game_looks',
    name: 'åˆ‡æ¢é€ å‹',
    description: 'åˆ‡æ¢åˆ°æŒ‡å®šé€ å‹',
    color: BLOCK_COLORS.game_looks,
    inputs: [
      { name: 'costume', label: 'é€ å‹', type: 'string', defaultValue: '', placeholder: 'é€ å‹åç§°' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ­ åˆ‡æ¢é€ å‹ä¸º {costume}',
  },
  {
    type: 'game_nextcostume',
    category: 'game_looks',
    name: 'ä¸‹ä¸€ä¸ªé€ å‹',
    description: 'åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªé€ å‹',
    color: BLOCK_COLORS.game_looks,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ­ ä¸‹ä¸€ä¸ªé€ å‹',
  },

  // ========== æ¸¸æˆä¾¦æµ‹ç±» ==========
  {
    type: 'game_istouching',
    category: 'game_sensing',
    name: 'ç¢°åˆ°äº†?',
    description: 'æ£€æµ‹æ˜¯å¦ç¢°åˆ°æŒ‡å®šæ ‡ç­¾çš„å¯¹è±¡',
    color: BLOCK_COLORS.game_sensing,
    inputs: [
      { name: 'tag', label: 'æ ‡ç­¾', type: 'string', defaultValue: '', placeholder: 'è¾“å…¥æ ‡ç­¾' },
    ],
    outputs: [{ name: 'result', type: 'boolean' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'ç¢°åˆ°äº† {tag}?',
  },
  {
    type: 'game_getposition',
    category: 'game_sensing',
    name: 'è·å–ä½ç½®',
    description: 'è·å–å½“å‰ä½ç½®',
    color: BLOCK_COLORS.game_sensing,
    inputs: [
      { name: 'axis', label: 'åæ ‡è½´', type: 'select', defaultValue: 'x', options: [
        { label: 'Xåæ ‡', value: 'x' },
        { label: 'Yåæ ‡', value: 'y' },
      ]},
    ],
    outputs: [{ name: 'position', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: '{axis} åæ ‡',
  },
  {
    type: 'game_getrotation',
    category: 'game_sensing',
    name: 'è·å–æ–¹å‘',
    description: 'è·å–å½“å‰æ–¹å‘è§’åº¦',
    color: BLOCK_COLORS.game_sensing,
    inputs: [],
    outputs: [{ name: 'rotation', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'æ–¹å‘è§’åº¦',
  },
  {
    type: 'game_distanceto',
    category: 'game_sensing',
    name: 'åˆ°...çš„è·ç¦»',
    description: 'è®¡ç®—åˆ°æŒ‡å®šä½ç½®çš„è·ç¦»',
    color: BLOCK_COLORS.game_sensing,
    inputs: [
      { name: 'x', label: 'Xä½ç½®', type: 'number', defaultValue: 0 },
      { name: 'y', label: 'Yä½ç½®', type: 'number', defaultValue: 0 },
    ],
    outputs: [{ name: 'distance', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'åˆ° ({x}, {y}) çš„è·ç¦»',
  },
  {
    type: 'game_keypressed',
    category: 'game_sensing',
    name: 'æŒ‰é”®è¢«æŒ‰ä¸‹?',
    description: 'æ£€æµ‹æŒ‰é”®æ˜¯å¦è¢«æŒ‰ä¸‹',
    color: BLOCK_COLORS.game_sensing,
    inputs: [
      { name: 'key', label: 'æŒ‰é”®', type: 'select', defaultValue: 'Space', options: [
        { label: 'â†‘ ä¸Š', value: 'ArrowUp' },
        { label: 'â†“ ä¸‹', value: 'ArrowDown' },
        { label: 'â† å·¦', value: 'ArrowLeft' },
        { label: 'â†’ å³', value: 'ArrowRight' },
        { label: 'ç©ºæ ¼', value: 'Space' },
        { label: 'W', value: 'KeyW' },
        { label: 'A', value: 'KeyA' },
        { label: 'S', value: 'KeyS' },
        { label: 'D', value: 'KeyD' },
      ]},
    ],
    outputs: [{ name: 'result', type: 'boolean' }],
    canHaveNext: false,
    canBeNested: true,
    template: '{key} è¢«æŒ‰ä¸‹?',
  },

  // ========== æ¸¸æˆçŠ¶æ€ç±» ==========
  {
    type: 'game_setscore',
    category: 'game_state',
    name: 'è®¾ç½®å¾—åˆ†',
    description: 'è®¾ç½®å¾—åˆ†ä¸ºæŒ‡å®šå€¼',
    color: BLOCK_COLORS.game_state,
    inputs: [
      { name: 'score', label: 'å¾—åˆ†', type: 'number', defaultValue: 0 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ¯ è®¾ç½®å¾—åˆ†ä¸º {score}',
  },
  {
    type: 'game_addscore',
    category: 'game_state',
    name: 'å¢åŠ å¾—åˆ†',
    description: 'å¢åŠ æŒ‡å®šå¾—åˆ†',
    color: BLOCK_COLORS.game_state,
    inputs: [
      { name: 'amount', label: 'åˆ†æ•°', type: 'number', defaultValue: 10 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â• å¢åŠ  {amount} åˆ†',
  },
  {
    type: 'game_getscore',
    category: 'game_state',
    name: 'å½“å‰å¾—åˆ†',
    description: 'è·å–å½“å‰å¾—åˆ†',
    color: BLOCK_COLORS.game_state,
    inputs: [],
    outputs: [{ name: 'score', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'å½“å‰å¾—åˆ†',
  },
  {
    type: 'game_setlives',
    category: 'game_state',
    name: 'è®¾ç½®ç”Ÿå‘½',
    description: 'è®¾ç½®ç”Ÿå‘½å€¼',
    color: BLOCK_COLORS.game_state,
    inputs: [
      { name: 'lives', label: 'ç”Ÿå‘½', type: 'number', defaultValue: 3 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â¤ï¸ è®¾ç½®ç”Ÿå‘½ä¸º {lives}',
  },
  {
    type: 'game_loselife',
    category: 'game_state',
    name: 'å‡å°‘ç”Ÿå‘½',
    description: 'å‡å°‘æŒ‡å®šç”Ÿå‘½å€¼',
    color: BLOCK_COLORS.game_state,
    inputs: [
      { name: 'amount', label: 'æ•°é‡', type: 'number', defaultValue: 1 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ’” å‡å°‘ {amount} ç”Ÿå‘½',
  },
  {
    type: 'game_getlives',
    category: 'game_state',
    name: 'å½“å‰ç”Ÿå‘½',
    description: 'è·å–å½“å‰ç”Ÿå‘½å€¼',
    color: BLOCK_COLORS.game_state,
    inputs: [],
    outputs: [{ name: 'lives', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'å½“å‰ç”Ÿå‘½',
  },
  {
    type: 'game_gotoscene',
    category: 'game_state',
    name: 'è·³è½¬åœºæ™¯',
    description: 'è·³è½¬åˆ°æŒ‡å®šåœºæ™¯',
    color: BLOCK_COLORS.game_state,
    inputs: [
      { name: 'sceneId', label: 'åœºæ™¯', type: 'string', defaultValue: '', placeholder: 'åœºæ™¯ID' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ¬ è·³è½¬åˆ°åœºæ™¯ {sceneId}',
  },
  {
    type: 'game_restartgame',
    category: 'game_state',
    name: 'é‡æ–°å¼€å§‹',
    description: 'é‡æ–°å¼€å§‹æ¸¸æˆ',
    color: BLOCK_COLORS.game_state,
    inputs: [],
    canHaveNext: false,
    canBeNested: false,
    template: 'ğŸ”„ é‡æ–°å¼€å§‹æ¸¸æˆ',
  },
  {
    type: 'game_gameover',
    category: 'game_state',
    name: 'æ¸¸æˆç»“æŸ',
    description: 'ç»“æŸæ¸¸æˆ',
    color: BLOCK_COLORS.game_state,
    inputs: [],
    canHaveNext: false,
    canBeNested: false,
    template: 'ğŸ›‘ æ¸¸æˆç»“æŸ',
  },

  // ========== æ¸¸æˆå…‹éš†ç±» ==========
  {
    type: 'game_clone',
    category: 'game_clone',
    name: 'å…‹éš†è‡ªå·±',
    description: 'åˆ›å»ºè‡ªå·±çš„å…‹éš†ä½“',
    color: BLOCK_COLORS.game_clone,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“‹ å…‹éš†è‡ªå·±',
  },
  {
    type: 'game_cloneof',
    category: 'game_clone',
    name: 'å…‹éš†',
    description: 'åˆ›å»ºæŒ‡å®šå¯¹è±¡çš„å…‹éš†ä½“',
    color: BLOCK_COLORS.game_clone,
    inputs: [
      { name: 'target', label: 'ç›®æ ‡', type: 'string', defaultValue: '', placeholder: 'å¯¹è±¡åç§°' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“‹ å…‹éš† {target}',
  },
  {
    type: 'game_destroy',
    category: 'game_clone',
    name: 'åˆ é™¤æ­¤å…‹éš†ä½“',
    description: 'åˆ é™¤å½“å‰å…‹éš†ä½“',
    color: BLOCK_COLORS.game_clone,
    inputs: [],
    canHaveNext: false,
    canBeNested: false,
    template: 'ğŸ—‘ï¸ åˆ é™¤æ­¤å…‹éš†ä½“',
  },
  {
    type: 'game_broadcast',
    category: 'game_clone',
    name: 'å¹¿æ’­æ¶ˆæ¯',
    description: 'å¹¿æ’­æŒ‡å®šæ¶ˆæ¯',
    color: BLOCK_COLORS.game_clone,
    inputs: [
      { name: 'message', label: 'æ¶ˆæ¯', type: 'string', defaultValue: '', placeholder: 'æ¶ˆæ¯åç§°' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“¢ å¹¿æ’­æ¶ˆæ¯ {message}',
  },
  {
    type: 'game_broadcastwait',
    category: 'game_clone',
    name: 'å¹¿æ’­å¹¶ç­‰å¾…',
    description: 'å¹¿æ’­æ¶ˆæ¯å¹¶ç­‰å¾…å®Œæˆ',
    color: BLOCK_COLORS.game_clone,
    inputs: [
      { name: 'message', label: 'æ¶ˆæ¯', type: 'string', defaultValue: '', placeholder: 'æ¶ˆæ¯åç§°' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“¢ å¹¿æ’­æ¶ˆæ¯ {message} å¹¶ç­‰å¾…',
  },

  // ========== æ¸¸æˆå£°éŸ³ç±» ==========
  {
    type: 'game_playsound',
    category: 'game_sound',
    name: 'æ’­æ”¾éŸ³æ•ˆ',
    description: 'æ’­æ”¾æŒ‡å®šéŸ³æ•ˆ',
    color: BLOCK_COLORS.game_sound,
    inputs: [
      { name: 'sound', label: 'éŸ³æ•ˆ', type: 'string', defaultValue: '', placeholder: 'éŸ³æ•ˆåç§°' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”Š æ’­æ”¾éŸ³æ•ˆ {sound}',
  },
  {
    type: 'game_playmusic',
    category: 'game_sound',
    name: 'æ’­æ”¾éŸ³ä¹',
    description: 'æ’­æ”¾èƒŒæ™¯éŸ³ä¹(å¾ªç¯)',
    color: BLOCK_COLORS.game_sound,
    inputs: [
      { name: 'music', label: 'éŸ³ä¹', type: 'string', defaultValue: '', placeholder: 'éŸ³ä¹åç§°' },
      { name: 'loop', label: 'å¾ªç¯', type: 'boolean', defaultValue: true },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸµ æ’­æ”¾éŸ³ä¹ {music}',
  },
  {
    type: 'game_stopsound',
    category: 'game_sound',
    name: 'åœæ­¢éŸ³æ•ˆ',
    description: 'åœæ­¢æŒ‡å®šéŸ³æ•ˆ',
    color: BLOCK_COLORS.game_sound,
    inputs: [
      { name: 'sound', label: 'éŸ³æ•ˆ', type: 'string', defaultValue: '', placeholder: 'éŸ³æ•ˆåç§°' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”‡ åœæ­¢éŸ³æ•ˆ {sound}',
  },
  {
    type: 'game_stopallsound',
    category: 'game_sound',
    name: 'åœæ­¢æ‰€æœ‰å£°éŸ³',
    description: 'åœæ­¢æ‰€æœ‰æ­£åœ¨æ’­æ”¾çš„å£°éŸ³',
    color: BLOCK_COLORS.game_sound,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”‡ åœæ­¢æ‰€æœ‰å£°éŸ³',
  },
  {
    type: 'game_setvolume',
    category: 'game_sound',
    name: 'è®¾ç½®éŸ³é‡',
    description: 'è®¾ç½®éŸ³é‡å¤§å°',
    color: BLOCK_COLORS.game_sound,
    inputs: [
      { name: 'volume', label: 'éŸ³é‡%', type: 'number', defaultValue: 100 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”‰ è®¾ç½®éŸ³é‡ä¸º {volume}%',
  },
  {
    type: 'game_changevolume',
    category: 'game_sound',
    name: 'æ”¹å˜éŸ³é‡',
    description: 'å¢å‡éŸ³é‡å¤§å°',
    color: BLOCK_COLORS.game_sound,
    inputs: [
      { name: 'amount', label: 'æ”¹å˜é‡', type: 'number', defaultValue: 10 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”‰ éŸ³é‡å¢åŠ  {amount}',
  },

  // ========== æ¸¸æˆç‰©ç†ç±» ==========
  {
    type: 'game_setgravity',
    category: 'game_physics',
    name: 'è®¾ç½®é‡åŠ›',
    description: 'è®¾ç½®é‡åŠ›å¤§å°',
    color: BLOCK_COLORS.game_physics,
    inputs: [
      { name: 'gravity', label: 'é‡åŠ›', type: 'number', defaultValue: 10 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â¬‡ï¸ è®¾ç½®é‡åŠ›ä¸º {gravity}',
  },
  {
    type: 'game_setfriction',
    category: 'game_physics',
    name: 'è®¾ç½®æ‘©æ“¦åŠ›',
    description: 'è®¾ç½®æ‘©æ“¦ç³»æ•°',
    color: BLOCK_COLORS.game_physics,
    inputs: [
      { name: 'friction', label: 'æ‘©æ“¦åŠ›', type: 'number', defaultValue: 0.5 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ›‘ è®¾ç½®æ‘©æ“¦åŠ›ä¸º {friction}',
  },
  {
    type: 'game_setbounce',
    category: 'game_physics',
    name: 'è®¾ç½®å¼¹æ€§',
    description: 'è®¾ç½®å¼¹æ€§ç³»æ•°',
    color: BLOCK_COLORS.game_physics,
    inputs: [
      { name: 'bounce', label: 'å¼¹æ€§', type: 'number', defaultValue: 0.8 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ€ è®¾ç½®å¼¹æ€§ä¸º {bounce}',
  },
  {
    type: 'game_applyforce',
    category: 'game_physics',
    name: 'æ–½åŠ åŠ›',
    description: 'å¯¹ç‰©ä½“æ–½åŠ åŠ›',
    color: BLOCK_COLORS.game_physics,
    inputs: [
      { name: 'fx', label: 'XåŠ›', type: 'number', defaultValue: 0 },
      { name: 'fy', label: 'YåŠ›', type: 'number', defaultValue: -100 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ’ª æ–½åŠ åŠ› ({fx}, {fy})',
  },
  {
    type: 'game_setmass',
    category: 'game_physics',
    name: 'è®¾ç½®è´¨é‡',
    description: 'è®¾ç½®ç‰©ä½“è´¨é‡',
    color: BLOCK_COLORS.game_physics,
    inputs: [
      { name: 'mass', label: 'è´¨é‡', type: 'number', defaultValue: 1 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'âš–ï¸ è®¾ç½®è´¨é‡ä¸º {mass}',
  },
  {
    type: 'game_enablephysics',
    category: 'game_physics',
    name: 'å¯ç”¨ç‰©ç†',
    description: 'å¯ç”¨æˆ–ç¦ç”¨ç‰©ç†æ¨¡æ‹Ÿ',
    color: BLOCK_COLORS.game_physics,
    inputs: [
      { name: 'enabled', label: 'å¯ç”¨', type: 'boolean', defaultValue: true },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'âš™ï¸ {enabled} ç‰©ç†æ¨¡æ‹Ÿ',
  },
  {
    type: 'game_place_invisible_platform',
    category: 'game_physics',
    name: 'æ”¾ç½®éšå½¢å¹³å°',
    description: 'åœ¨æŒ‡å®šä½ç½®æ”¾ç½®ä¸€ä¸ªéšå½¢å¹³å°ï¼Œè§’è‰²å¯ä»¥åœ¨ä¸Šé¢è¡Œèµ°',
    color: BLOCK_COLORS.game_physics,
    inputs: [
      { name: 'x', label: 'Xä½ç½®', type: 'number', defaultValue: 200 },
      { name: 'y', label: 'Yä½ç½®', type: 'number', defaultValue: 300 },
      { name: 'width', label: 'å®½åº¦', type: 'number', defaultValue: 200 },
      { name: 'height', label: 'é«˜åº¦', type: 'number', defaultValue: 20 },
      { name: 'id', label: 'å¹³å°ID', type: 'string', defaultValue: 'platform1' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”² æ”¾ç½®éšå½¢å¹³å° ({x}, {y}) å¤§å° {width}Ã—{height} ID:{id}',
  },
  {
    type: 'game_remove_invisible_platform',
    category: 'game_physics',
    name: 'ç§»é™¤éšå½¢å¹³å°',
    description: 'ç§»é™¤æŒ‡å®šIDçš„éšå½¢å¹³å°',
    color: BLOCK_COLORS.game_physics,
    inputs: [
      { name: 'id', label: 'å¹³å°ID', type: 'string', defaultValue: 'platform1' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'âŒ ç§»é™¤éšå½¢å¹³å° ID:{id}',
  },

  // ========== æ¸¸æˆç‰¹æ•ˆç±» ==========
  {
    type: 'game_seteffect',
    category: 'game_effect',
    name: 'è®¾ç½®ç‰¹æ•ˆ',
    description: 'è®¾ç½®è§†è§‰ç‰¹æ•ˆ',
    color: BLOCK_COLORS.game_effect,
    inputs: [
      { name: 'effect', label: 'ç‰¹æ•ˆ', type: 'select', defaultValue: 'blur', options: [
        { label: 'æ¨¡ç³Š', value: 'blur' },
        { label: 'äº®åº¦', value: 'brightness' },
        { label: 'å¯¹æ¯”åº¦', value: 'contrast' },
        { label: 'è‰²ç›¸', value: 'hue' },
        { label: 'é¥±å’Œåº¦', value: 'saturation' },
        { label: 'ç°åº¦', value: 'grayscale' },
        { label: 'åè‰²', value: 'invert' },
      ]},
      { name: 'value', label: 'å€¼', type: 'number', defaultValue: 0 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'âœ¨ è®¾ç½® {effect} ç‰¹æ•ˆä¸º {value}',
  },
  {
    type: 'game_changeeffect',
    category: 'game_effect',
    name: 'æ”¹å˜ç‰¹æ•ˆ',
    description: 'æ”¹å˜è§†è§‰ç‰¹æ•ˆå€¼',
    color: BLOCK_COLORS.game_effect,
    inputs: [
      { name: 'effect', label: 'ç‰¹æ•ˆ', type: 'select', defaultValue: 'blur', options: [
        { label: 'æ¨¡ç³Š', value: 'blur' },
        { label: 'äº®åº¦', value: 'brightness' },
        { label: 'å¯¹æ¯”åº¦', value: 'contrast' },
        { label: 'è‰²ç›¸', value: 'hue' },
        { label: 'é¥±å’Œåº¦', value: 'saturation' },
      ]},
      { name: 'amount', label: 'æ”¹å˜é‡', type: 'number', defaultValue: 10 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'âœ¨ {effect} ç‰¹æ•ˆå¢åŠ  {amount}',
  },
  {
    type: 'game_cleareffects',
    category: 'game_effect',
    name: 'æ¸…é™¤ç‰¹æ•ˆ',
    description: 'æ¸…é™¤æ‰€æœ‰è§†è§‰ç‰¹æ•ˆ',
    color: BLOCK_COLORS.game_effect,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ§¹ æ¸…é™¤æ‰€æœ‰ç‰¹æ•ˆ',
  },
  {
    type: 'game_shake',
    category: 'game_effect',
    name: 'éœ‡åŠ¨',
    description: 'éœ‡åŠ¨ç”»é¢',
    color: BLOCK_COLORS.game_effect,
    inputs: [
      { name: 'intensity', label: 'å¼ºåº¦', type: 'number', defaultValue: 5 },
      { name: 'duration', label: 'æ—¶é•¿(ç§’)', type: 'number', defaultValue: 0.5 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“³ éœ‡åŠ¨ å¼ºåº¦{intensity} æ—¶é•¿{duration}ç§’',
  },
  {
    type: 'game_flash',
    category: 'game_effect',
    name: 'é—ªå…‰',
    description: 'ç”»é¢é—ªå…‰æ•ˆæœ',
    color: BLOCK_COLORS.game_effect,
    inputs: [
      { name: 'color', label: 'é¢œè‰²', type: 'string', defaultValue: '#FFFFFF' },
      { name: 'duration', label: 'æ—¶é•¿(ç§’)', type: 'number', defaultValue: 0.3 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ’¥ é—ªå…‰ {color} æŒç»­{duration}ç§’',
  },
  {
    type: 'game_fadein',
    category: 'game_effect',
    name: 'æ·¡å…¥',
    description: 'ç”»é¢æ·¡å…¥æ•ˆæœ',
    color: BLOCK_COLORS.game_effect,
    inputs: [
      { name: 'duration', label: 'æ—¶é•¿(ç§’)', type: 'number', defaultValue: 1 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸŒ… æ·¡å…¥ {duration}ç§’',
  },
  {
    type: 'game_fadeout',
    category: 'game_effect',
    name: 'æ·¡å‡º',
    description: 'ç”»é¢æ·¡å‡ºæ•ˆæœ',
    color: BLOCK_COLORS.game_effect,
    inputs: [
      { name: 'duration', label: 'æ—¶é•¿(ç§’)', type: 'number', defaultValue: 1 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸŒ† æ·¡å‡º {duration}ç§’',
  },

  // ========== æ¸¸æˆåˆ—è¡¨ç±» ==========
  {
    type: 'game_createlist',
    category: 'game_list',
    name: 'åˆ›å»ºåˆ—è¡¨',
    description: 'åˆ›å»ºæ–°åˆ—è¡¨',
    color: BLOCK_COLORS.game_list,
    inputs: [
      { name: 'name', label: 'åˆ—è¡¨å', type: 'string', defaultValue: '', placeholder: 'åˆ—è¡¨åç§°' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“‹ åˆ›å»ºåˆ—è¡¨ {name}',
  },
  {
    type: 'game_addtolist',
    category: 'game_list',
    name: 'æ·»åŠ åˆ°åˆ—è¡¨',
    description: 'å‘åˆ—è¡¨æœ«å°¾æ·»åŠ é¡¹ç›®',
    color: BLOCK_COLORS.game_list,
    inputs: [
      { name: 'item', label: 'é¡¹ç›®', type: 'expression', required: true, placeholder: 'å€¼' },
      { name: 'list', label: 'åˆ—è¡¨', type: 'string', required: true, placeholder: 'åˆ—è¡¨å' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â• å°† {item} æ·»åŠ åˆ° {list}',
  },
  {
    type: 'game_removefromlist',
    category: 'game_list',
    name: 'ä»åˆ—è¡¨åˆ é™¤',
    description: 'ä»åˆ—è¡¨ä¸­åˆ é™¤æŒ‡å®šä½ç½®çš„é¡¹ç›®',
    color: BLOCK_COLORS.game_list,
    inputs: [
      { name: 'index', label: 'ä½ç½®', type: 'number', defaultValue: 1 },
      { name: 'list', label: 'åˆ—è¡¨', type: 'string', required: true, placeholder: 'åˆ—è¡¨å' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â– åˆ é™¤ {list} çš„ç¬¬ {index} é¡¹',
  },
  {
    type: 'game_getlistitem',
    category: 'game_list',
    name: 'åˆ—è¡¨é¡¹ç›®',
    description: 'è·å–åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„é¡¹ç›®',
    color: BLOCK_COLORS.game_list,
    inputs: [
      { name: 'index', label: 'ä½ç½®', type: 'number', defaultValue: 1 },
      { name: 'list', label: 'åˆ—è¡¨', type: 'string', required: true, placeholder: 'åˆ—è¡¨å' },
    ],
    outputs: [{ name: 'item', type: 'any' }],
    canHaveNext: false,
    canBeNested: true,
    template: '{list} çš„ç¬¬ {index} é¡¹',
  },
  {
    type: 'game_setlistitem',
    category: 'game_list',
    name: 'è®¾ç½®åˆ—è¡¨é¡¹',
    description: 'è®¾ç½®åˆ—è¡¨ä¸­æŒ‡å®šä½ç½®çš„é¡¹ç›®',
    color: BLOCK_COLORS.game_list,
    inputs: [
      { name: 'index', label: 'ä½ç½®', type: 'number', defaultValue: 1 },
      { name: 'list', label: 'åˆ—è¡¨', type: 'string', required: true, placeholder: 'åˆ—è¡¨å' },
      { name: 'value', label: 'å€¼', type: 'expression', required: true, placeholder: 'æ–°å€¼' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“ å°† {list} çš„ç¬¬ {index} é¡¹è®¾ä¸º {value}',
  },
  {
    type: 'game_listlength',
    category: 'game_list',
    name: 'åˆ—è¡¨é•¿åº¦',
    description: 'è·å–åˆ—è¡¨çš„é¡¹ç›®æ•°é‡',
    color: BLOCK_COLORS.game_list,
    inputs: [
      { name: 'list', label: 'åˆ—è¡¨', type: 'string', required: true, placeholder: 'åˆ—è¡¨å' },
    ],
    outputs: [{ name: 'length', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: '{list} çš„é•¿åº¦',
  },
  {
    type: 'game_listcontains',
    category: 'game_list',
    name: 'åˆ—è¡¨åŒ…å«',
    description: 'æ£€æŸ¥åˆ—è¡¨æ˜¯å¦åŒ…å«æŒ‡å®šé¡¹ç›®',
    color: BLOCK_COLORS.game_list,
    inputs: [
      { name: 'list', label: 'åˆ—è¡¨', type: 'string', required: true, placeholder: 'åˆ—è¡¨å' },
      { name: 'item', label: 'é¡¹ç›®', type: 'expression', required: true, placeholder: 'æŸ¥æ‰¾å€¼' },
    ],
    outputs: [{ name: 'result', type: 'boolean' }],
    canHaveNext: false,
    canBeNested: true,
    template: '{list} åŒ…å« {item}?',
  },

  // ========== æ›´å¤šæ§åˆ¶ç±» ==========
  {
    type: 'control_forever',
    category: 'control',
    name: 'æ°¸è¿œé‡å¤',
    description: 'æ°¸è¿œé‡å¤æ‰§è¡Œ',
    color: BLOCK_COLORS.control,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ” æ°¸è¿œé‡å¤',
  },
  {
    type: 'control_waituntil',
    category: 'control',
    name: 'ç­‰å¾…ç›´åˆ°',
    description: 'ç­‰å¾…ç›´åˆ°æ¡ä»¶æ»¡è¶³',
    color: BLOCK_COLORS.control,
    inputs: [
      { name: 'condition', label: 'æ¡ä»¶', type: 'expression', required: true, placeholder: 'æ¡ä»¶' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â³ ç­‰å¾…ç›´åˆ° {condition}',
  },
  {
    type: 'control_repeatuntil',
    category: 'control',
    name: 'é‡å¤ç›´åˆ°',
    description: 'é‡å¤æ‰§è¡Œç›´åˆ°æ¡ä»¶æ»¡è¶³',
    color: BLOCK_COLORS.control,
    inputs: [
      { name: 'condition', label: 'æ¡ä»¶', type: 'expression', required: true, placeholder: 'æ¡ä»¶' },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ” é‡å¤ç›´åˆ° {condition}',
  },

  // ========== æ›´å¤šäº‹ä»¶ç±» ==========
  {
    type: 'game_event_touch',
    category: 'game_event',
    name: 'å½“è§¦æ‘¸æ—¶',
    description: 'å½“è§¦æ‘¸å±å¹•æ—¶æ‰§è¡Œ',
    color: BLOCK_COLORS.game_event,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ‘† å½“è§¦æ‘¸æ—¶',
  },
  {
    type: 'game_event_swipe',
    category: 'game_event',
    name: 'å½“æ»‘åŠ¨æ—¶',
    description: 'å½“æ»‘åŠ¨å±å¹•æ—¶æ‰§è¡Œ',
    color: BLOCK_COLORS.game_event,
    inputs: [
      { name: 'direction', label: 'æ–¹å‘', type: 'select', defaultValue: 'any', options: [
        { label: 'ä»»æ„æ–¹å‘', value: 'any' },
        { label: 'å‘ä¸Š', value: 'up' },
        { label: 'å‘ä¸‹', value: 'down' },
        { label: 'å‘å·¦', value: 'left' },
        { label: 'å‘å³', value: 'right' },
      ]},
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ‘† å½“æ»‘åŠ¨ {direction} æ—¶',
  },
  {
    type: 'game_event_timer',
    category: 'game_event',
    name: 'å½“è®¡æ—¶å™¨åˆ°è¾¾',
    description: 'å½“è®¡æ—¶å™¨è¾¾åˆ°æŒ‡å®šæ—¶é—´æ—¶æ‰§è¡Œ',
    color: BLOCK_COLORS.game_event,
    inputs: [
      { name: 'time', label: 'æ—¶é—´(ç§’)', type: 'number', defaultValue: 10 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â° å½“è®¡æ—¶å™¨åˆ°è¾¾ {time} ç§’',
  },
  {
    type: 'game_event_keyup',
    category: 'game_event',
    name: 'å½“æ¾å¼€æŒ‰é”®',
    description: 'å½“æ¾å¼€æŒ‡å®šæŒ‰é”®æ—¶æ‰§è¡Œ',
    color: BLOCK_COLORS.game_event,
    inputs: [
      { name: 'key', label: 'æŒ‰é”®', type: 'select', defaultValue: 'any', options: [
        { label: 'ä»»æ„é”®', value: 'any' },
        { label: 'â†‘ ä¸Š', value: 'ArrowUp' },
        { label: 'â†“ ä¸‹', value: 'ArrowDown' },
        { label: 'â† å·¦', value: 'ArrowLeft' },
        { label: 'â†’ å³', value: 'ArrowRight' },
        { label: 'ç©ºæ ¼', value: 'Space' },
        { label: 'W', value: 'KeyW' },
        { label: 'A', value: 'KeyA' },
        { label: 'S', value: 'KeyS' },
        { label: 'D', value: 'KeyD' },
      ]},
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'âŒ¨ï¸ å½“æ¾å¼€ {key}',
  },

  // ========== è®¡æ—¶å™¨ç±» ==========
  {
    type: 'game_resettimer',
    category: 'game_sensing',
    name: 'é‡ç½®è®¡æ—¶å™¨',
    description: 'å°†è®¡æ—¶å™¨é‡ç½®ä¸º0',
    color: BLOCK_COLORS.game_sensing,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'â±ï¸ é‡ç½®è®¡æ—¶å™¨',
  },
  {
    type: 'game_gettimer',
    category: 'game_sensing',
    name: 'è®¡æ—¶å™¨',
    description: 'è·å–å½“å‰è®¡æ—¶å™¨çš„å€¼',
    color: BLOCK_COLORS.game_sensing,
    inputs: [],
    outputs: [{ name: 'time', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'è®¡æ—¶å™¨',
  },

  // ========== æ‘„åƒæœºç±» ==========
  {
    type: 'game_camera_follow',
    category: 'game_camera',
    name: 'æ‘„åƒæœºè·Ÿéš',
    description: 'è®©æ‘„åƒæœºè·ŸéšæŒ‡å®šè§’è‰²',
    color: BLOCK_COLORS.game_camera,
    inputs: [
      { name: 'enabled', label: 'å¯ç”¨è·Ÿéš', type: 'boolean', defaultValue: true },
      { name: 'speed', label: 'è·Ÿéšé€Ÿåº¦', type: 'number', defaultValue: 0.1 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“¹ {enabled} æ‘„åƒæœºè·Ÿéš é€Ÿåº¦ {speed}',
  },
  {
    type: 'game_set_scene_size',
    category: 'game_camera',
    name: 'è®¾ç½®åœºæ™¯å¤§å°',
    description: 'è®¾ç½®æ¸¸æˆåœºæ™¯çš„å®½åº¦å’Œé«˜åº¦',
    color: BLOCK_COLORS.game_camera,
    inputs: [
      { name: 'width', label: 'å®½åº¦', type: 'number', defaultValue: 3000 },
      { name: 'height', label: 'é«˜åº¦', type: 'number', defaultValue: 600 },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ—ºï¸ è®¾ç½®åœºæ™¯å¤§å° {width}Ã—{height}',
  },
  {
    type: 'game_set_background',
    category: 'game_camera',
    name: 'è®¾ç½®èƒŒæ™¯å›¾åƒ',
    description: 'è®¾ç½®å•å¼ é•¿èƒŒæ™¯å›¾',
    color: BLOCK_COLORS.game_camera,
    inputs: [
      { name: 'imageUrl', label: 'å›¾ç‰‡URL', type: 'string', defaultValue: '' },
      { name: 'loop', label: 'å¾ªç¯', type: 'boolean', defaultValue: false },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ–¼ï¸ è®¾ç½®èƒŒæ™¯å›¾ {imageUrl} å¾ªç¯:{loop}',
  },
  {
    type: 'game_add_parallax_layer',
    category: 'game_camera',
    name: 'æ·»åŠ è§†å·®èƒŒæ™¯å±‚',
    description: 'æ·»åŠ è§†å·®æ»šåŠ¨èƒŒæ™¯å±‚',
    color: BLOCK_COLORS.game_camera,
    inputs: [
      { name: 'imageUrl', label: 'å›¾ç‰‡URL', type: 'string', defaultValue: '' },
      { name: 'speed', label: 'æ»šåŠ¨é€Ÿåº¦', type: 'number', defaultValue: 0.5 },
      { name: 'layer', label: 'å±‚çº§', type: 'select', defaultValue: 'back', options: [
        { label: 'è¿œæ™¯', value: 'far' },
        { label: 'ä¸­æ™¯', value: 'middle' },
        { label: 'è¿‘æ™¯', value: 'near' },
      ]},
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”ï¸ æ·»åŠ è§†å·®å±‚ {imageUrl} é€Ÿåº¦{speed} {layer}',
  },
  {
    type: 'game_set_scroll_direction',
    category: 'game_camera',
    name: 'è®¾ç½®æ»šåŠ¨æ–¹å‘',
    description: 'è®¾ç½®åœºæ™¯æ»šåŠ¨æ–¹å‘',
    color: BLOCK_COLORS.game_camera,
    inputs: [
      { name: 'direction', label: 'æ–¹å‘', type: 'select', defaultValue: 'horizontal', options: [
        { label: 'æ¨ªå‘æ»šåŠ¨', value: 'horizontal' },
        { label: 'çºµå‘æ»šåŠ¨', value: 'vertical' },
        { label: 'è‡ªç”±æ»šåŠ¨', value: 'free' },
      ]},
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â†”ï¸ è®¾ç½®æ»šåŠ¨æ–¹å‘ {direction}',
  },
  {
    type: 'game_set_boundary_mode',
    category: 'game_camera',
    name: 'è®¾ç½®è¾¹ç•Œæ¨¡å¼',
    description: 'è®¾ç½®åœºæ™¯è¾¹ç•Œæ¨¡å¼',
    color: BLOCK_COLORS.game_camera,
    inputs: [
      { name: 'mode', label: 'æ¨¡å¼', type: 'select', defaultValue: 'bounded', options: [
        { label: 'æœ‰è¾¹ç•Œ', value: 'bounded' },
        { label: 'æ— é™å¾ªç¯', value: 'infinite' },
      ]},
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”² è®¾ç½®è¾¹ç•Œæ¨¡å¼ {mode}',
  },
  {
    type: 'game_enable_drag',
    category: 'game_camera',
    name: 'å¯ç”¨æ‰‹åŠ¨æ‹–æ‹½',
    description: 'å¯ç”¨æˆ–ç¦ç”¨æ‰‹åŠ¨æ‹–æ‹½è§†å£',
    color: BLOCK_COLORS.game_camera,
    inputs: [
      { name: 'enabled', label: 'å¯ç”¨', type: 'boolean', defaultValue: true },
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ‘† {enabled} æ‰‹åŠ¨æ‹–æ‹½',
  },
];

// æ ¹æ®ç±»åˆ«è·å–ç§¯æœ¨
export function getBlocksByCategory(category: BlockCategory): BlockDefinition[] {
  return BLOCK_DEFINITIONS.filter(b => b.category === category);
}

// æ ¹æ®ç±»å‹è·å–ç§¯æœ¨å®šä¹‰
export function getBlockDefinition(type: BlockType): BlockDefinition | undefined {
  return BLOCK_DEFINITIONS.find(b => b.type === type);
}

// åˆ›å»ºæ–°ç§¯æœ¨å®ä¾‹
export function createBlock(type: BlockType): Block | null {
  const def = getBlockDefinition(type);
  if (!def) return null;

  return {
    id: `block_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
    type,
    category: def.category,
    name: def.name,
    inputs: def.inputs.map(input => ({
      ...input,
      blockId: undefined,
    })),
    outputs: def.outputs,
    values: def.inputs.reduce((acc, input) => {
      acc[input.name] = input.defaultValue;
      return acc;
    }, {} as Record<string, unknown>),
  };
}
