// ç§¯æœ¨å—ç±»å‹å®šä¹‰ - å…¨æ–°7å¤§æ¨¡å—æ¶æ„

// ç§¯æœ¨å—åŸºç¡€ç±»å‹
export interface Block {
  id: string;
  type: BlockType;
  category: BlockCategory;
  name: string;
  inputs: BlockInput[];
  outputs?: BlockOutput[];
  next?: string; // ä¸‹ä¸€ä¸ªå—çš„ID
  parent?: string; // çˆ¶å—ID
  values: Record<string, unknown>;
}

// ç§¯æœ¨ç±»åˆ« - 7å¤§æ ¸å¿ƒæ¨¡å—
export type BlockCategory =
  | 'state'         // çŠ¶æ€ç®¡ç† - ç²‰çº¢è‰²
  | 'event'         // äº‹ä»¶ç³»ç»Ÿ - é‡‘é»„è‰²
  | 'motion'        // è¿åŠ¨æ§åˆ¶ - å¤©è“è‰²
  | 'looks'         // å¤–è§‚ä¸å£°éŸ³ - ç´«è‰²
  | 'sensing'       // ä¾¦æµ‹ä¸ç‰©ç† - é’è“è‰²
  | 'effects'       // ç‰¹æ•ˆç³»ç»Ÿ - ç´«çº¢è‰²
  | 'logic';        // é€»è¾‘è¿ç®— - é›è“è‰²

// ç§¯æœ¨ç±»å‹
export type BlockType =
  // ========== çŠ¶æ€ç®¡ç†æ¨¡å— ==========
  | 'state_setscore'           // è®¾ç½®å¾—åˆ†
  | 'state_addscore'           // å¢åŠ å¾—åˆ†
  | 'state_getscore'           // è·å–å¾—åˆ†
  | 'state_setlives'           // è®¾ç½®ç”Ÿå‘½å€¼
  | 'state_addlives'           // å¢åŠ ç”Ÿå‘½å€¼
  | 'state_getlives'           // è·å–ç”Ÿå‘½å€¼
  | 'state_gotoscene'          // è·³è½¬åœºæ™¯
  | 'state_sethighscore'       // è®°å½•æœ€é«˜åˆ†
  | 'state_gethighscore'       // è·å–æœ€é«˜åˆ†
  | 'state_resetstate'         // é‡ç½®æ‰€æœ‰çŠ¶æ€
  | 'state_setcharstate'       // è®¾ç½®è§’è‰²çŠ¶æ€
  | 'state_getcharstate'       // è·å–è§’è‰²çŠ¶æ€
  | 'state_savestate'          // ä¿å­˜çŠ¶æ€åˆ°æœ¬åœ°
  | 'state_loadstate'          // ä»æœ¬åœ°åŠ è½½çŠ¶æ€

  // ========== äº‹ä»¶ç³»ç»Ÿæ¨¡å— ==========
  | 'event_click'              // å½“ç‚¹å‡»æ—¶
  | 'event_keypress'           // å½“æŒ‰é”®æ—¶
  | 'event_sceneinit'          // åœºæ™¯åˆå§‹åŒ–æ—¶
  | 'event_timer'              // å®šæ—¶è§¦å‘
  | 'event_collision'          // ç¢°æ’è§¦å‘
  | 'event_dragstart'          // å¼€å§‹æ‹–æ‹½
  | 'event_dragend'            // ç»“æŸæ‹–æ‹½
  | 'event_message'            // æ”¶åˆ°æ¶ˆæ¯æ—¶

  // ========== è¿åŠ¨æ§åˆ¶æ¨¡å— ==========
  | 'motion_move'              // å®šå‘ç§»åŠ¨
  | 'motion_rotate'            // æ—‹è½¬
  | 'motion_moveto'            // ç¬ç§»åˆ°åæ ‡
  | 'motion_easeto'            // ç¼“åŠ¨ç§»åŠ¨
  | 'motion_followpath'        // æ²¿è·¯å¾„è¿åŠ¨
  | 'motion_setgravity'        // è®¾ç½®é‡åŠ›
  | 'motion_setvelocity'       // è®¾ç½®é€Ÿåº¦
  | 'motion_followtarget'      // è·Ÿéšç›®æ ‡

  // ========== å¤–è§‚ä¸å£°éŸ³æ¨¡å— ==========
  | 'looks_showbubble'         // æ˜¾ç¤ºå¯¹è¯æ°”æ³¡
  | 'looks_setcostume'         // åˆ‡æ¢é€ å‹
  | 'looks_playsound'          // æ’­æ”¾éŸ³æ•ˆ
  | 'looks_playanimation'      // æ’­æ”¾åŠ¨ç”»åºåˆ—
  | 'looks_setvolume'          // è®¾ç½®éŸ³é‡
  | 'looks_emitparticles'      // ç²’å­ç‰¹æ•ˆ
  | 'looks_speak'              // æ–‡å­—è½¬è¯­éŸ³

  // ========== ä¾¦æµ‹ä¸ç‰©ç†æ¨¡å— ==========
  | 'sensing_touching'         // ç¢°åˆ°è§’è‰²
  | 'sensing_touchingcolor'    // ç¢°åˆ°é¢œè‰²
  | 'sensing_distanceto'       // è·ç¦»è®¡ç®—
  | 'sensing_inzone'           // åœ¨åŒºåŸŸå†…
  | 'sensing_angleto'          // ç›¸å¯¹è§’åº¦
  | 'sensing_raycast'          // å…‰çº¿æ£€æµ‹
  | 'sensing_getvelocity'      // è·å–é€Ÿåº¦
  | 'sensing_getacceleration'  // è·å–åŠ é€Ÿåº¦

  // ========== ç‰¹æ•ˆç³»ç»Ÿæ¨¡å— ==========
  | 'effects_setopacity'       // è®¾ç½®é€æ˜åº¦
  | 'effects_setcolor'         // è®¾ç½®é¢œè‰²è‰²è°ƒ
  | 'effects_setsize'          // è®¾ç½®å¤§å°
  | 'effects_setblur'          // è®¾ç½®æ¨¡ç³Š
  | 'effects_shake'            // å±å¹•éœ‡åŠ¨
  | 'effects_fadein'           // æ·¡å…¥
  | 'effects_fadeout'          // æ·¡å‡º

  // ========== é€»è¾‘è¿ç®—æ¨¡å— ==========
  | 'logic_if'                 // å¦‚æœæ¡ä»¶
  | 'logic_ifelse'             // å¦‚æœå¦åˆ™
  | 'logic_repeat'             // é‡å¤å¾ªç¯
  | 'logic_forever'            // æ°¸è¿œå¾ªç¯
  | 'logic_compare'            // æ¯”è¾ƒè¿ç®—
  | 'logic_and'                // é€»è¾‘ä¸
  | 'logic_or'                 // é€»è¾‘æˆ–
  | 'logic_not'                // é€»è¾‘é
  | 'logic_switch'             // å¤šæ¡ä»¶åˆ†æ”¯
  | 'logic_parallel'           // å¹¶è¡Œæ‰§è¡Œ
  | 'logic_waituntil'          // ç­‰å¾…æ¡ä»¶
  | 'logic_break'              // ä¸­æ–­æ‰§è¡Œ


// ç§¯æœ¨è¾“å…¥
export interface BlockInput {
  name: string;
  label: string;
  type: BlockInputType;
  defaultValue?: unknown;
  options?: { label: string; value: unknown }[];
  placeholder?: string;
  required?: boolean;
  blockId?: string; // å¦‚æœæ˜¯åµŒå¥—å—
}

export type BlockInputType =
  | 'string'
  | 'number'
  | 'boolean'
  | 'select'
  | 'variable'
  | 'expression'
  | 'block'      // å¯åµŒå¥—å—
  | 'component'; // ç»„ä»¶å¼•ç”¨

// ç§¯æœ¨è¾“å‡º
export interface BlockOutput {
  name: string;
  type: 'value' | 'boolean' | 'any';
}

// ç§¯æœ¨å®šä¹‰ï¼ˆç”¨äºç§¯æœ¨åº“ï¼‰
export interface BlockDefinition {
  type: BlockType;
  category: BlockCategory;
  name: string;
  description: string;
  icon?: string;
  color: string;
  inputs: Omit<BlockInput, 'blockId'>[];
  outputs?: BlockOutput[];
  canHaveNext: boolean; // æ˜¯å¦å¯ä»¥æœ‰ä¸‹ä¸€ä¸ªå—
  canBeNested: boolean; // æ˜¯å¦å¯ä»¥è¢«åµŒå¥—
  template: string; // æ˜¾ç¤ºæ¨¡æ¿
}

// ç§¯æœ¨è¿æ¥
export interface BlockConnection {
  fromBlockId: string;
  fromOutput?: string;
  toBlockId: string;
  toInput: string;
}

// äº‹ä»¶é€»è¾‘ç»„
export interface EventLogicGroup {
  id: string;
  componentId: string;
  trigger: string;
  blocks: Block[];
  connections: BlockConnection[];
  enabled: boolean;
}

// ç§¯æœ¨ç¼–è¾‘å™¨çŠ¶æ€
export interface BlockEditorState {
  selectedBlockId: string | null;
  draggingBlock: Block | null;
  clipboard: Block | null;
  zoom: number;
  panOffset: { x: number; y: number };
}

// é¢œè‰²é…ç½® - 7å¤§æ¨¡å—ä¸»é¢˜è‰²
export const BLOCK_COLORS: Record<BlockCategory, string> = {
  state: '#FF6680',      // ç²‰çº¢è‰² - çŠ¶æ€ç®¡ç†
  event: '#FFBF00',      // é‡‘é»„è‰² - äº‹ä»¶ç³»ç»Ÿ
  motion: '#4C97FF',     // å¤©è“è‰² - è¿åŠ¨æ§åˆ¶
  looks: '#9966FF',      // ç´«è‰² - å¤–è§‚ä¸å£°éŸ³
  sensing: '#5CB1D6',    // é’è“è‰² - ä¾¦æµ‹ä¸ç‰©ç†
  effects: '#9933FF',    // ç´«çº¢è‰² - ç‰¹æ•ˆç³»ç»Ÿ
  logic: '#5B80A5',      // é›è“è‰² - é€»è¾‘è¿ç®—
};

// ========================================
// ç§¯æœ¨åº“å®šä¹‰ - 7å¤§æ ¸å¿ƒæ¨¡å—
// ========================================
export const BLOCK_DEFINITIONS: BlockDefinition[] = [

  // ========================================
  // 1. çŠ¶æ€ç®¡ç†æ¨¡å—
  // ========================================
  {
    type: 'state_setscore',
    category: 'state',
    name: 'è®¾ç½®å¾—åˆ†',
    description: 'è®¾ç½®å½“å‰å¾—åˆ†ä¸ºæŒ‡å®šå€¼',
    color: BLOCK_COLORS.state,
    inputs: [
      { name: 'score', label: 'å¾—åˆ†', type: 'number', defaultValue: 0 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ¯ è®¾ç½®å¾—åˆ†ä¸º {score}'
  },
  {
    type: 'state_addscore',
    category: 'state',
    name: 'å¢åŠ å¾—åˆ†',
    description: 'å¢åŠ æŒ‡å®šåˆ†æ•°',
    color: BLOCK_COLORS.state,
    inputs: [
      { name: 'amount', label: 'åˆ†æ•°', type: 'number', defaultValue: 10 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â• å¢åŠ  {amount} åˆ†'
  },
  {
    type: 'state_getscore',
    category: 'state',
    name: 'å½“å‰å¾—åˆ†',
    description: 'è·å–å½“å‰å¾—åˆ†',
    color: BLOCK_COLORS.state,
    inputs: [],
    outputs: [{ name: 'score', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ å½“å‰å¾—åˆ†'
  },
  {
    type: 'state_setlives',
    category: 'state',
    name: 'è®¾ç½®ç”Ÿå‘½å€¼',
    description: 'è®¾ç½®ç”Ÿå‘½å€¼ä¸ºæŒ‡å®šå€¼',
    color: BLOCK_COLORS.state,
    inputs: [
      { name: 'lives', label: 'ç”Ÿå‘½', type: 'number', defaultValue: 3 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â¤ï¸ è®¾ç½®ç”Ÿå‘½ä¸º {lives}'
  },
  {
    type: 'state_addlives',
    category: 'state',
    name: 'å¢å‡ç”Ÿå‘½å€¼',
    description: 'å¢åŠ æˆ–å‡å°‘ç”Ÿå‘½å€¼',
    color: BLOCK_COLORS.state,
    inputs: [
      { name: 'amount', label: 'æ•°é‡', type: 'number', defaultValue: 1 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ’ ç”Ÿå‘½å€¼æ”¹å˜ {amount}'
  },
  {
    type: 'state_getlives',
    category: 'state',
    name: 'å½“å‰ç”Ÿå‘½å€¼',
    description: 'è·å–å½“å‰ç”Ÿå‘½å€¼',
    color: BLOCK_COLORS.state,
    inputs: [],
    outputs: [{ name: 'lives', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ å½“å‰ç”Ÿå‘½'
  },
  {
    type: 'state_gotoscene',
    category: 'state',
    name: 'è·³è½¬åœºæ™¯',
    description: 'è·³è½¬åˆ°æŒ‡å®šåœºæ™¯æˆ–å…³å¡',
    color: BLOCK_COLORS.state,
    inputs: [
      { name: 'sceneId', label: 'åœºæ™¯ID', type: 'string', placeholder: 'åœºæ™¯åç§°' }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ¬ è·³è½¬åˆ°åœºæ™¯ {sceneId}'
  },
  {
    type: 'state_sethighscore',
    category: 'state',
    name: 'è®°å½•æœ€é«˜åˆ†',
    description: 'å¦‚æœå½“å‰å¾—åˆ†è¶…è¿‡æœ€é«˜åˆ†åˆ™æ›´æ–°',
    color: BLOCK_COLORS.state,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ† è®°å½•æœ€é«˜åˆ†'
  },
  {
    type: 'state_gethighscore',
    category: 'state',
    name: 'æœ€é«˜åˆ†',
    description: 'è·å–å†å²æœ€é«˜åˆ†',
    color: BLOCK_COLORS.state,
    inputs: [],
    outputs: [{ name: 'highscore', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ æœ€é«˜åˆ†'
  },
  {
    type: 'state_resetstate',
    category: 'state',
    name: 'é‡ç½®æ‰€æœ‰çŠ¶æ€',
    description: 'é‡ç½®å¾—åˆ†ã€ç”Ÿå‘½ç­‰æ‰€æœ‰çŠ¶æ€',
    color: BLOCK_COLORS.state,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”„ é‡ç½®æ‰€æœ‰çŠ¶æ€'
  },
  {
    type: 'state_setcharstate',
    category: 'state',
    name: 'è®¾ç½®è§’è‰²çŠ¶æ€',
    description: 'ä¸ºæŒ‡å®šè§’è‰²è®¾ç½®è‡ªå®šä¹‰çŠ¶æ€',
    color: BLOCK_COLORS.state,
    inputs: [
      { name: 'charId', label: 'è§’è‰²ID', type: 'string', placeholder: 'è§’è‰²åç§°' },
      { name: 'key', label: 'çŠ¶æ€å', type: 'string', placeholder: 'å¦‚: health' },
      { name: 'value', label: 'å€¼', type: 'expression', required: true }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“ è®¾ç½® {charId} çš„ {key} ä¸º {value}'
  },
  {
    type: 'state_getcharstate',
    category: 'state',
    name: 'è·å–è§’è‰²çŠ¶æ€',
    description: 'è·å–æŒ‡å®šè§’è‰²çš„çŠ¶æ€å€¼',
    color: BLOCK_COLORS.state,
    inputs: [
      { name: 'charId', label: 'è§’è‰²ID', type: 'string', placeholder: 'è§’è‰²åç§°' },
      { name: 'key', label: 'çŠ¶æ€å', type: 'string', placeholder: 'å¦‚: health' }
    ],
    outputs: [{ name: 'value', type: 'any' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ {charId} çš„ {key}'
  },
  {
    type: 'state_savestate',
    category: 'state',
    name: 'ä¿å­˜çŠ¶æ€',
    description: 'ä¿å­˜å½“å‰çŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨',
    color: BLOCK_COLORS.state,
    inputs: [
      { name: 'slot', label: 'å­˜æ¡£æ§½', type: 'string', defaultValue: 'save1', placeholder: 'å­˜æ¡£åç§°' }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ’¾ ä¿å­˜çŠ¶æ€åˆ° {slot}'
  },
  {
    type: 'state_loadstate',
    category: 'state',
    name: 'åŠ è½½çŠ¶æ€',
    description: 'ä»æœ¬åœ°å­˜å‚¨åŠ è½½çŠ¶æ€',
    color: BLOCK_COLORS.state,
    inputs: [
      { name: 'slot', label: 'å­˜æ¡£æ§½', type: 'string', defaultValue: 'save1', placeholder: 'å­˜æ¡£åç§°' }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“‚ åŠ è½½çŠ¶æ€ä» {slot}'
  },

  // ========================================
  // 2. äº‹ä»¶ç³»ç»Ÿæ¨¡å—
  // ========================================
  {
    type: 'event_click',
    category: 'event',
    name: 'å½“ç‚¹å‡»æ—¶',
    description: 'å½“ç‚¹å‡»æ­¤è§’è‰²æ—¶è§¦å‘',
    color: BLOCK_COLORS.event,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ–±ï¸ å½“ç‚¹å‡»æ—¶'
  },
  {
    type: 'event_keypress',
    category: 'event',
    name: 'å½“æŒ‰é”®æ—¶',
    description: 'å½“æŒ‰ä¸‹æŒ‡å®šæŒ‰é”®æ—¶è§¦å‘',
    color: BLOCK_COLORS.event,
    inputs: [
      { name: 'key', label: 'æŒ‰é”®', type: 'select', defaultValue: 'Space', options: [
        { label: 'ç©ºæ ¼', value: 'Space' },
        { label: 'â†‘ ä¸Š', value: 'ArrowUp' },
        { label: 'â†“ ä¸‹', value: 'ArrowDown' },
        { label: 'â† å·¦', value: 'ArrowLeft' },
        { label: 'â†’ å³', value: 'ArrowRight' },
        { label: 'W', value: 'KeyW' },
        { label: 'A', value: 'KeyA' },
        { label: 'S', value: 'KeyS' },
        { label: 'D', value: 'KeyD' }
      ]}
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'âŒ¨ï¸ å½“æŒ‰ä¸‹ {key}'
  },
  {
    type: 'event_sceneinit',
    category: 'event',
    name: 'åœºæ™¯åˆå§‹åŒ–',
    description: 'åœºæ™¯å¼€å§‹æ—¶è§¦å‘',
    color: BLOCK_COLORS.event,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ¬ å½“åœºæ™¯å¼€å§‹'
  },
  {
    type: 'event_timer',
    category: 'event',
    name: 'å®šæ—¶è§¦å‘',
    description: 'æ¯éš”æŒ‡å®šæ—¶é—´è§¦å‘',
    color: BLOCK_COLORS.event,
    inputs: [
      { name: 'seconds', label: 'ç§’æ•°', type: 'number', defaultValue: 1 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â° æ¯éš” {seconds} ç§’'
  },
  {
    type: 'event_collision',
    category: 'event',
    name: 'ç¢°æ’è§¦å‘',
    description: 'å½“ç¢°åˆ°æŒ‡å®šè§’è‰²æ—¶è§¦å‘',
    color: BLOCK_COLORS.event,
    inputs: [
      { name: 'target', label: 'ç›®æ ‡', type: 'string', placeholder: 'è§’è‰²åç§°' }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ’¥ å½“ç¢°åˆ° {target}'
  },
  {
    type: 'event_dragstart',
    category: 'event',
    name: 'å¼€å§‹æ‹–æ‹½',
    description: 'å½“å¼€å§‹æ‹–æ‹½æ—¶è§¦å‘',
    color: BLOCK_COLORS.event,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ¤ å½“å¼€å§‹æ‹–æ‹½'
  },
  {
    type: 'event_dragend',
    category: 'event',
    name: 'ç»“æŸæ‹–æ‹½',
    description: 'å½“ç»“æŸæ‹–æ‹½æ—¶è§¦å‘',
    color: BLOCK_COLORS.event,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'âœ‹ å½“ç»“æŸæ‹–æ‹½'
  },
  {
    type: 'event_message',
    category: 'event',
    name: 'æ”¶åˆ°æ¶ˆæ¯æ—¶',
    description: 'å½“æ”¶åˆ°è‡ªå®šä¹‰æ¶ˆæ¯æ—¶è§¦å‘',
    color: BLOCK_COLORS.event,
    inputs: [
      { name: 'message', label: 'æ¶ˆæ¯', type: 'string', placeholder: 'æ¶ˆæ¯åç§°' }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“¨ å½“æ”¶åˆ°æ¶ˆæ¯ {message}'
  },

  // ========================================
  // 3. è¿åŠ¨æ§åˆ¶æ¨¡å—
  // ========================================
  {
    type: 'motion_move',
    category: 'motion',
    name: 'å®šå‘ç§»åŠ¨',
    description: 'å‘æŒ‡å®šæ–¹å‘ç§»åŠ¨',
    color: BLOCK_COLORS.motion,
    inputs: [
      { name: 'distance', label: 'è·ç¦»', type: 'number', defaultValue: 10 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â¡ï¸ ç§»åŠ¨ {distance} æ­¥'
  },
  {
    type: 'motion_rotate',
    category: 'motion',
    name: 'æ—‹è½¬',
    description: 'æ—‹è½¬æŒ‡å®šè§’åº¦',
    color: BLOCK_COLORS.motion,
    inputs: [
      { name: 'angle', label: 'è§’åº¦', type: 'number', defaultValue: 15 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”„ æ—‹è½¬ {angle} åº¦'
  },
  {
    type: 'motion_moveto',
    category: 'motion',
    name: 'ç¬ç§»åˆ°åæ ‡',
    description: 'ç¬é—´ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®',
    color: BLOCK_COLORS.motion,
    inputs: [
      { name: 'x', label: 'Xåæ ‡', type: 'number', defaultValue: 0 },
      { name: 'y', label: 'Yåæ ‡', type: 'number', defaultValue: 0 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“ ç¬ç§»åˆ° ({x}, {y})'
  },
  {
    type: 'motion_easeto',
    category: 'motion',
    name: 'ç¼“åŠ¨ç§»åŠ¨',
    description: 'ä½¿ç”¨ç¼“åŠ¨æ•ˆæœå¹³æ»‘ç§»åŠ¨',
    color: BLOCK_COLORS.motion,
    inputs: [
      { name: 'x', label: 'Xåæ ‡', type: 'number', defaultValue: 0 },
      { name: 'y', label: 'Yåæ ‡', type: 'number', defaultValue: 0 },
      { name: 'duration', label: 'æ—¶é•¿(ç§’)', type: 'number', defaultValue: 1 },
      { name: 'easing', label: 'ç¼“åŠ¨', type: 'select', defaultValue: 'easeInOut', options: [
        { label: 'ç¼“å…¥ç¼“å‡º', value: 'easeInOut' },
        { label: 'ç¼“å…¥', value: 'easeIn' },
        { label: 'ç¼“å‡º', value: 'easeOut' },
        { label: 'å¼¹æ€§', value: 'elastic' }
      ]}
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ¯ ç¼“åŠ¨åˆ° ({x}, {y}) {duration}ç§’ {easing}'
  },
  {
    type: 'motion_followpath',
    category: 'motion',
    name: 'æ²¿è·¯å¾„è¿åŠ¨',
    description: 'æ²¿é¢„è®¾è·¯å¾„ç§»åŠ¨',
    color: BLOCK_COLORS.motion,
    inputs: [
      { name: 'pathId', label: 'è·¯å¾„ID', type: 'string', placeholder: 'è·¯å¾„åç§°' },
      { name: 'speed', label: 'é€Ÿåº¦', type: 'number', defaultValue: 100 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ›¤ï¸ æ²¿è·¯å¾„ {pathId} ç§»åŠ¨ é€Ÿåº¦{speed}'
  },
  {
    type: 'motion_setgravity',
    category: 'motion',
    name: 'è®¾ç½®é‡åŠ›',
    description: 'è®¾ç½®é‡åŠ›åŠ é€Ÿåº¦',
    color: BLOCK_COLORS.motion,
    inputs: [
      { name: 'gravity', label: 'é‡åŠ›', type: 'number', defaultValue: 10 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â¬‡ï¸ è®¾ç½®é‡åŠ› {gravity}'
  },
  {
    type: 'motion_setvelocity',
    category: 'motion',
    name: 'è®¾ç½®é€Ÿåº¦',
    description: 'è®¾ç½®ç§»åŠ¨é€Ÿåº¦å‘é‡',
    color: BLOCK_COLORS.motion,
    inputs: [
      { name: 'vx', label: 'Xé€Ÿåº¦', type: 'number', defaultValue: 0 },
      { name: 'vy', label: 'Yé€Ÿåº¦', type: 'number', defaultValue: 0 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ’¨ è®¾ç½®é€Ÿåº¦ ({vx}, {vy})'
  },
  {
    type: 'motion_followtarget',
    category: 'motion',
    name: 'è·Ÿéšç›®æ ‡',
    description: 'è‡ªåŠ¨è·Ÿéšé¼ æ ‡æˆ–å…¶ä»–ç›®æ ‡',
    color: BLOCK_COLORS.motion,
    inputs: [
      { name: 'target', label: 'ç›®æ ‡', type: 'select', defaultValue: 'mouse', options: [
        { label: 'é¼ æ ‡', value: 'mouse' },
        { label: 'æŒ‡å®šè§’è‰²', value: 'character' }
      ]},
      { name: 'targetId', label: 'è§’è‰²ID', type: 'string', placeholder: '(å¦‚æœé€‰æ‹©è§’è‰²)' },
      { name: 'speed', label: 'é€Ÿåº¦', type: 'number', defaultValue: 5 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ‘£ è·Ÿéš {target} é€Ÿåº¦{speed}'
  },

  // ========================================
  // 4. å¤–è§‚ä¸å£°éŸ³æ¨¡å—
  // ========================================
  {
    type: 'looks_showbubble',
    category: 'looks',
    name: 'æ˜¾ç¤ºå¯¹è¯æ°”æ³¡',
    description: 'æ˜¾ç¤ºå¯¹è¯æ°”æ³¡',
    color: BLOCK_COLORS.looks,
    inputs: [
      { name: 'text', label: 'å¯¹è¯å†…å®¹', type: 'string', required: true, placeholder: 'è¯´çš„è¯' },
      { name: 'duration', label: 'æ—¶é•¿(ç§’)', type: 'number', defaultValue: 2 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ’¬ è¯´ "{text}" {duration}ç§’'
  },
  {
    type: 'looks_setcostume',
    category: 'looks',
    name: 'åˆ‡æ¢é€ å‹',
    description: 'åˆ‡æ¢åˆ°æŒ‡å®šé€ å‹',
    color: BLOCK_COLORS.looks,
    inputs: [
      { name: 'costume', label: 'é€ å‹', type: 'string', placeholder: 'é€ å‹åç§°' }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ­ åˆ‡æ¢é€ å‹ {costume}'
  },
  {
    type: 'looks_playsound',
    category: 'looks',
    name: 'æ’­æ”¾éŸ³æ•ˆ',
    description: 'æ’­æ”¾æŒ‡å®šéŸ³æ•ˆ',
    color: BLOCK_COLORS.looks,
    inputs: [
      { name: 'sound', label: 'éŸ³æ•ˆ', type: 'string', placeholder: 'éŸ³æ•ˆåç§°' }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”Š æ’­æ”¾éŸ³æ•ˆ {sound}'
  },
  {
    type: 'looks_playanimation',
    category: 'looks',
    name: 'æ’­æ”¾åŠ¨ç”»åºåˆ—',
    description: 'æ’­æ”¾å¤šå¸§åŠ¨ç”»',
    color: BLOCK_COLORS.looks,
    inputs: [
      { name: 'animation', label: 'åŠ¨ç”»', type: 'string', placeholder: 'åŠ¨ç”»åç§°' },
      { name: 'loop', label: 'å¾ªç¯', type: 'boolean', defaultValue: false }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ¬ æ’­æ”¾åŠ¨ç”» {animation} å¾ªç¯:{loop}'
  },
  {
    type: 'looks_setvolume',
    category: 'looks',
    name: 'è®¾ç½®éŸ³é‡',
    description: 'è°ƒèŠ‚éŸ³æ•ˆéŸ³é‡',
    color: BLOCK_COLORS.looks,
    inputs: [
      { name: 'volume', label: 'éŸ³é‡%', type: 'number', defaultValue: 100 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”‰ è®¾ç½®éŸ³é‡ {volume}%'
  },
  {
    type: 'looks_emitparticles',
    category: 'looks',
    name: 'ç²’å­ç‰¹æ•ˆ',
    description: 'å‘å°„ç²’å­ç‰¹æ•ˆ(ç«èŠ±ã€çƒŸé›¾ç­‰)',
    color: BLOCK_COLORS.looks,
    inputs: [
      { name: 'particle', label: 'ç²’å­', type: 'select', defaultValue: 'spark', options: [
        { label: 'ç«èŠ±', value: 'spark' },
        { label: 'çƒŸé›¾', value: 'smoke' },
        { label: 'æ˜Ÿæ˜Ÿ', value: 'star' }
      ]},
      { name: 'count', label: 'æ•°é‡', type: 'number', defaultValue: 10 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'âœ¨ å‘å°„ {count} ä¸ª {particle}'
  },
  {
    type: 'looks_speak',
    category: 'looks',
    name: 'æ–‡å­—è½¬è¯­éŸ³',
    description: 'ä½¿ç”¨TTSæœ—è¯»æ–‡æœ¬',
    color: BLOCK_COLORS.looks,
    inputs: [
      { name: 'text', label: 'æ–‡æœ¬', type: 'string', required: true, placeholder: 'æœ—è¯»å†…å®¹' },
      { name: 'voice', label: 'å£°éŸ³', type: 'select', defaultValue: 'default', options: [
        { label: 'é»˜è®¤', value: 'default' },
        { label: 'ç”·å£°', value: 'male' },
        { label: 'å¥³å£°', value: 'female' }
      ]}
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ—£ï¸ æœ—è¯» "{text}" å£°éŸ³:{voice}'
  },

  // ========================================
  // 5. ä¾¦æµ‹ä¸ç‰©ç†æ¨¡å—
  // ========================================
  {
    type: 'sensing_touching',
    category: 'sensing',
    name: 'ç¢°åˆ°è§’è‰²',
    description: 'æ£€æµ‹æ˜¯å¦ç¢°åˆ°æŒ‡å®šè§’è‰²',
    color: BLOCK_COLORS.sensing,
    inputs: [
      { name: 'target', label: 'ç›®æ ‡', type: 'string', placeholder: 'è§’è‰²åç§°' }
    ],
    outputs: [{ name: 'result', type: 'boolean' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‡ ç¢°åˆ° {target}?'
  },
  {
    type: 'sensing_touchingcolor',
    category: 'sensing',
    name: 'ç¢°åˆ°é¢œè‰²',
    description: 'æ£€æµ‹æ˜¯å¦ç¢°åˆ°æŒ‡å®šé¢œè‰²',
    color: BLOCK_COLORS.sensing,
    inputs: [
      { name: 'color', label: 'é¢œè‰²', type: 'string', defaultValue: '#FF0000' }
    ],
    outputs: [{ name: 'result', type: 'boolean' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‡ ç¢°åˆ°é¢œè‰² {color}?'
  },
  {
    type: 'sensing_distanceto',
    category: 'sensing',
    name: 'è·ç¦»è®¡ç®—',
    description: 'è®¡ç®—åˆ°ç›®æ ‡çš„è·ç¦»',
    color: BLOCK_COLORS.sensing,
    inputs: [
      { name: 'target', label: 'ç›®æ ‡', type: 'select', defaultValue: 'mouse', options: [
        { label: 'é¼ æ ‡', value: 'mouse' },
        { label: 'æŒ‡å®šè§’è‰²', value: 'character' }
      ]},
      { name: 'targetId', label: 'è§’è‰²ID', type: 'string', placeholder: '(å¦‚æœé€‰æ‹©è§’è‰²)' }
    ],
    outputs: [{ name: 'distance', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ åˆ° {target} çš„è·ç¦»'
  },
  {
    type: 'sensing_inzone',
    category: 'sensing',
    name: 'åœ¨åŒºåŸŸå†…',
    description: 'æ£€æµ‹æ˜¯å¦åœ¨æŒ‡å®šåŒºåŸŸå†…',
    color: BLOCK_COLORS.sensing,
    inputs: [
      { name: 'zoneId', label: 'åŒºåŸŸID', type: 'string', placeholder: 'åŒºåŸŸåç§°' }
    ],
    outputs: [{ name: 'result', type: 'boolean' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‡ åœ¨åŒºåŸŸ {zoneId} å†…?'
  },
  {
    type: 'sensing_angleto',
    category: 'sensing',
    name: 'ç›¸å¯¹è§’åº¦',
    description: 'è®¡ç®—ä¸ç›®æ ‡çš„ç›¸å¯¹è§’åº¦',
    color: BLOCK_COLORS.sensing,
    inputs: [
      { name: 'target', label: 'ç›®æ ‡', type: 'string', placeholder: 'è§’è‰²åç§°' }
    ],
    outputs: [{ name: 'angle', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ åˆ° {target} çš„è§’åº¦'
  },
  {
    type: 'sensing_raycast',
    category: 'sensing',
    name: 'å…‰çº¿æ£€æµ‹',
    description: 'æ¨¡æ‹Ÿå…‰çº¿æŠ•å°„æˆ–è§†çº¿æ£€æµ‹',
    color: BLOCK_COLORS.sensing,
    inputs: [
      { name: 'angle', label: 'è§’åº¦', type: 'number', defaultValue: 0 },
      { name: 'distance', label: 'è·ç¦»', type: 'number', defaultValue: 100 }
    ],
    outputs: [{ name: 'hit', type: 'boolean' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‡ å°„çº¿æ£€æµ‹ è§’åº¦{angle} è·ç¦»{distance}'
  },
  {
    type: 'sensing_getvelocity',
    category: 'sensing',
    name: 'è·å–é€Ÿåº¦',
    description: 'è·å–å½“å‰é€Ÿåº¦',
    color: BLOCK_COLORS.sensing,
    inputs: [
      { name: 'axis', label: 'è½´', type: 'select', defaultValue: 'magnitude', options: [
        { label: 'é€Ÿåº¦å¤§å°', value: 'magnitude' },
        { label: 'Xé€Ÿåº¦', value: 'x' },
        { label: 'Yé€Ÿåº¦', value: 'y' }
      ]}
    ],
    outputs: [{ name: 'velocity', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ {axis}'
  },
  {
    type: 'sensing_getacceleration',
    category: 'sensing',
    name: 'è·å–åŠ é€Ÿåº¦',
    description: 'è·å–å½“å‰åŠ é€Ÿåº¦',
    color: BLOCK_COLORS.sensing,
    inputs: [
      { name: 'axis', label: 'è½´', type: 'select', defaultValue: 'magnitude', options: [
        { label: 'åŠ é€Ÿåº¦å¤§å°', value: 'magnitude' },
        { label: 'XåŠ é€Ÿåº¦', value: 'x' },
        { label: 'YåŠ é€Ÿåº¦', value: 'y' }
      ]}
    ],
    outputs: [{ name: 'acceleration', type: 'value' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‹ {axis}'
  },

  // ========================================
  // 6. ç‰¹æ•ˆç³»ç»Ÿæ¨¡å—
  // ========================================
  {
    type: 'effects_setopacity',
    category: 'effects',
    name: 'è®¾ç½®é€æ˜åº¦',
    description: 'è°ƒæ•´è§’è‰²é€æ˜åº¦',
    color: BLOCK_COLORS.effects,
    inputs: [
      { name: 'opacity', label: 'é€æ˜åº¦%', type: 'number', defaultValue: 100 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ’§ é€æ˜åº¦ {opacity}%'
  },
  {
    type: 'effects_setcolor',
    category: 'effects',
    name: 'è®¾ç½®é¢œè‰²è‰²è°ƒ',
    description: 'æ”¹å˜é¢œè‰²è‰²è°ƒ',
    color: BLOCK_COLORS.effects,
    inputs: [
      { name: 'hue', label: 'è‰²è°ƒ', type: 'number', defaultValue: 0 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ¨ è‰²è°ƒ {hue}'
  },
  {
    type: 'effects_setsize',
    category: 'effects',
    name: 'è®¾ç½®å¤§å°',
    description: 'è®¾ç½®è§’è‰²å¤§å°',
    color: BLOCK_COLORS.effects,
    inputs: [
      { name: 'scale', label: 'ç¼©æ”¾%', type: 'number', defaultValue: 100 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“ å¤§å° {scale}%'
  },
  {
    type: 'effects_setblur',
    category: 'effects',
    name: 'è®¾ç½®æ¨¡ç³Š',
    description: 'åº”ç”¨æ¨¡ç³Šæ•ˆæœ',
    color: BLOCK_COLORS.effects,
    inputs: [
      { name: 'amount', label: 'æ¨¡ç³Šé‡', type: 'number', defaultValue: 0 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸŒ«ï¸ æ¨¡ç³Š {amount}'
  },
  {
    type: 'effects_shake',
    category: 'effects',
    name: 'å±å¹•éœ‡åŠ¨',
    description: 'éœ‡åŠ¨å±å¹•',
    color: BLOCK_COLORS.effects,
    inputs: [
      { name: 'intensity', label: 'å¼ºåº¦', type: 'number', defaultValue: 5 },
      { name: 'duration', label: 'æ—¶é•¿(ç§’)', type: 'number', defaultValue: 0.5 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ“³ éœ‡åŠ¨ å¼ºåº¦{intensity} {duration}ç§’'
  },
  {
    type: 'effects_fadein',
    category: 'effects',
    name: 'æ·¡å…¥',
    description: 'æ·¡å…¥æ•ˆæœ',
    color: BLOCK_COLORS.effects,
    inputs: [
      { name: 'duration', label: 'æ—¶é•¿(ç§’)', type: 'number', defaultValue: 1 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸŒ… æ·¡å…¥ {duration}ç§’'
  },
  {
    type: 'effects_fadeout',
    category: 'effects',
    name: 'æ·¡å‡º',
    description: 'æ·¡å‡ºæ•ˆæœ',
    color: BLOCK_COLORS.effects,
    inputs: [
      { name: 'duration', label: 'æ—¶é•¿(ç§’)', type: 'number', defaultValue: 1 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸŒ† æ·¡å‡º {duration}ç§’'
  },

  // ========================================
  // 7. é€»è¾‘è¿ç®—æ¨¡å—
  // ========================================
  {
    type: 'logic_if',
    category: 'logic',
    name: 'å¦‚æœæ¡ä»¶',
    description: 'å¦‚æœæ¡ä»¶æ»¡è¶³åˆ™æ‰§è¡Œ',
    color: BLOCK_COLORS.logic,
    inputs: [
      { name: 'condition', label: 'æ¡ä»¶', type: 'expression', required: true, placeholder: 'æ¡ä»¶è¡¨è¾¾å¼' }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”€ å¦‚æœ {condition} é‚£ä¹ˆ'
  },
  {
    type: 'logic_ifelse',
    category: 'logic',
    name: 'å¦‚æœå¦åˆ™',
    description: 'å¦‚æœå¦åˆ™åˆ†æ”¯',
    color: BLOCK_COLORS.logic,
    inputs: [
      { name: 'condition', label: 'æ¡ä»¶', type: 'expression', required: true, placeholder: 'æ¡ä»¶è¡¨è¾¾å¼' }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”€ å¦‚æœ {condition} é‚£ä¹ˆ...å¦åˆ™...'
  },
  {
    type: 'logic_repeat',
    category: 'logic',
    name: 'é‡å¤å¾ªç¯',
    description: 'é‡å¤æ‰§è¡ŒæŒ‡å®šæ¬¡æ•°',
    color: BLOCK_COLORS.logic,
    inputs: [
      { name: 'times', label: 'æ¬¡æ•°', type: 'number', defaultValue: 10 }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ” é‡å¤ {times} æ¬¡'
  },
  {
    type: 'logic_forever',
    category: 'logic',
    name: 'æ°¸è¿œå¾ªç¯',
    description: 'æ°¸è¿œé‡å¤æ‰§è¡Œ',
    color: BLOCK_COLORS.logic,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'â™¾ï¸ æ°¸è¿œé‡å¤'
  },
  {
    type: 'logic_compare',
    category: 'logic',
    name: 'æ¯”è¾ƒè¿ç®—',
    description: 'æ¯”è¾ƒä¸¤ä¸ªå€¼',
    color: BLOCK_COLORS.logic,
    inputs: [
      { name: 'left', label: 'å·¦å€¼', type: 'expression', required: true, placeholder: 'å€¼1' },
      { name: 'operator', label: 'è¿ç®—ç¬¦', type: 'select', defaultValue: '==', options: [
        { label: '=', value: '==' },
        { label: 'â‰ ', value: '!=' },
        { label: '>', value: '>' },
        { label: '<', value: '<' },
        { label: 'â‰¥', value: '>=' },
        { label: 'â‰¤', value: '<=' }
      ]},
      { name: 'right', label: 'å³å€¼', type: 'expression', required: true, placeholder: 'å€¼2' }
    ],
    outputs: [{ name: 'result', type: 'boolean' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‡ {left} {operator} {right}'
  },
  {
    type: 'logic_and',
    category: 'logic',
    name: 'é€»è¾‘ä¸',
    description: 'ä¸¤ä¸ªæ¡ä»¶éƒ½æ»¡è¶³',
    color: BLOCK_COLORS.logic,
    inputs: [
      { name: 'left', label: 'æ¡ä»¶1', type: 'expression', required: true },
      { name: 'right', label: 'æ¡ä»¶2', type: 'expression', required: true }
    ],
    outputs: [{ name: 'result', type: 'boolean' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‡ {left} ä¸ {right}'
  },
  {
    type: 'logic_or',
    category: 'logic',
    name: 'é€»è¾‘æˆ–',
    description: 'æ»¡è¶³ä»»ä¸€æ¡ä»¶',
    color: BLOCK_COLORS.logic,
    inputs: [
      { name: 'left', label: 'æ¡ä»¶1', type: 'expression', required: true },
      { name: 'right', label: 'æ¡ä»¶2', type: 'expression', required: true }
    ],
    outputs: [{ name: 'result', type: 'boolean' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‡ {left} æˆ– {right}'
  },
  {
    type: 'logic_not',
    category: 'logic',
    name: 'é€»è¾‘é',
    description: 'æ¡ä»¶å–å',
    color: BLOCK_COLORS.logic,
    inputs: [
      { name: 'condition', label: 'æ¡ä»¶', type: 'expression', required: true }
    ],
    outputs: [{ name: 'result', type: 'boolean' }],
    canHaveNext: false,
    canBeNested: true,
    template: 'â—‡ ä¸æ»¡è¶³ {condition}'
  },
  {
    type: 'logic_switch',
    category: 'logic',
    name: 'å¤šæ¡ä»¶åˆ†æ”¯',
    description: 'æ ¹æ®å€¼é€‰æ‹©ä¸åŒåˆ†æ”¯',
    color: BLOCK_COLORS.logic,
    inputs: [
      { name: 'value', label: 'å€¼', type: 'expression', required: true }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'ğŸ”€ æ ¹æ® {value} é€‰æ‹©'
  },
  {
    type: 'logic_parallel',
    category: 'logic',
    name: 'å¹¶è¡Œæ‰§è¡Œ',
    description: 'åŒæ—¶æ‰§è¡Œå¤šä¸ªè„šæœ¬',
    color: BLOCK_COLORS.logic,
    inputs: [],
    canHaveNext: true,
    canBeNested: false,
    template: 'âš¡ åŒæ—¶æ‰§è¡Œ'
  },
  {
    type: 'logic_waituntil',
    category: 'logic',
    name: 'ç­‰å¾…æ¡ä»¶',
    description: 'ç­‰å¾…ç›´åˆ°æ¡ä»¶æ»¡è¶³',
    color: BLOCK_COLORS.logic,
    inputs: [
      { name: 'condition', label: 'æ¡ä»¶', type: 'expression', required: true }
    ],
    canHaveNext: true,
    canBeNested: false,
    template: 'â³ ç­‰å¾…ç›´åˆ° {condition}'
  },
  {
    type: 'logic_break',
    category: 'logic',
    name: 'ä¸­æ–­æ‰§è¡Œ',
    description: 'è·³å‡ºå¾ªç¯æˆ–ä¸­æ–­æ‰§è¡Œ',
    color: BLOCK_COLORS.logic,
    inputs: [],
    canHaveNext: false,
    canBeNested: false,
    template: 'ğŸšª ä¸­æ–­æ‰§è¡Œ'
  }
];

// æ ¹æ®ç±»åˆ«è·å–ç§¯æœ¨
export function getBlocksByCategory(category: BlockCategory): BlockDefinition[] {
  return BLOCK_DEFINITIONS.filter(b => b.category === category);
}

// æ ¹æ®ç±»å‹è·å–ç§¯æœ¨å®šä¹‰
export function getBlockDefinition(type: BlockType): BlockDefinition | undefined {
  return BLOCK_DEFINITIONS.find(b => b.type === type);
}

// åˆ›å»ºæ–°ç§¯æœ¨å®ä¾‹
export function createBlock(type: BlockType): Block | null {
  const def = getBlockDefinition(type);
  if (!def) return null;

  return {
    id: `block_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
    type,
    category: def.category,
    name: def.name,
    inputs: def.inputs.map(input => ({
      ...input,
      blockId: undefined,
    })),
    outputs: def.outputs,
    values: def.inputs.reduce((acc, input) => {
      acc[input.name] = input.defaultValue;
      return acc;
    }, {} as Record<string, unknown>),
  };
}
