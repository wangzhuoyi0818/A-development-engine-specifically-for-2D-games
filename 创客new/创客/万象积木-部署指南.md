# 🎨 万象积木 - AutoDL 部署指南

## ✨ 项目简介

**万象积木** - 游戏创作平台
用积木搭建你的游戏世界，支持可视化编程、虚拟摇杆、键盘控制等功能。

---

## 📋 服务器信息

**SSH 连接：**
```bash
ssh -p 55567 root@connect.bjb1.seetacloud.com
密码: RYzudn9KCm27
```

**公网访问地址：**
```
https://u812392-b4f4-d1b0eded.bjb1.seetacloud.com:8443
```

**端口映射：**
- 容器端口 `6006` → 公网端口 `8443`
- 协议：**HTTP**

---

## 🚀 部署步骤（3分钟完成）

### 第一步：上传文件

1. **打开 AutoDL JupyterLab**
   - 在 AutoDL 控制台点击"打开 JupyterLab"

2. **上传压缩包**
   - 点击工具栏的"⬆️ 上传"按钮
   - 选择文件：`wanxiang-blocks.tar.gz` (36MB)
   - 上传到 `/root/` 目录
   - 等待上传完成（1-3分钟）

---

### 第二步：运行部署命令

在 JupyterLab 打开终端（**File → New → Terminal**），复制粘贴运行：

```bash
# ========================================
# 万象积木 - 一键部署脚本
# ========================================

echo "🎨 开始部署万象积木..."

# 1. 检查文件
if [ ! -f "/root/wanxiang-blocks.tar.gz" ]; then
    echo "❌ 未找到 wanxiang-blocks.tar.gz"
    echo "请先上传文件到 /root/ 目录"
    exit 1
fi

echo "✅ 找到部署文件"

# 2. 安装 Node.js
if ! command -v node &> /dev/null; then
    echo "📦 安装 Node.js..."
    curl -fsSL https://deb.nodesource.com/setup_20.x | bash - > /dev/null 2>&1
    apt install -y nodejs > /dev/null 2>&1
fi

echo "✅ Node.js: $(node -v)"

# 3. 安装 pm2
npm install -g pm2 serve > /dev/null 2>&1
echo "✅ pm2 已安装"

# 4. 准备目录
rm -rf /root/wanxiang
mkdir -p /root/wanxiang
cd /root/wanxiang

# 5. 解压文件
echo "📦 解压文件..."
tar -xzf /root/wanxiang-blocks.tar.gz

# 6. 验证
if [ ! -f "index.html" ]; then
    echo "❌ 解压失败"
    exit 1
fi

echo "✅ 文件解压成功"

# 7. 停止旧服务
pm2 delete wanxiang 2>/dev/null || true

# 8. 启动服务
echo "🚀 启动服务..."
pm2 serve /root/wanxiang 6006 --spa --name wanxiang

# 9. 保存配置
pm2 save > /dev/null 2>&1
pm2 startup > /dev/null 2>&1

# 10. 等待启动
sleep 2

echo ""
echo "=========================================="
echo "✅ 万象积木部署完成！"
echo "=========================================="
echo ""

pm2 status

echo ""
echo "🔍 测试访问："
curl -I http://localhost:6006 2>&1 | head -3

echo ""
echo "🌐 公网访问地址："
echo "https://u812392-b4f4-d1b0eded.bjb1.seetacloud.com:8443"
echo ""
echo "💡 管理命令："
echo "  pm2 status           - 查看状态"
echo "  pm2 logs wanxiang    - 查看日志"
echo "  pm2 restart wanxiang - 重启服务"
echo ""
```

---

### 第三步：访问测试

在浏览器打开：
```
https://u812392-b4f4-d1b0eded.bjb1.seetacloud.com:8443
```

---

## 🎮 功能测试

1. ✅ 页面标题显示"万象积木"
2. ✅ 创建新项目
3. ✅ 添加精灵组件
4. ✅ 拖拽虚拟摇杆到画布
5. ✅ 进入预览模式测试：
   - 键盘控制（WASD）
   - 鼠标拖动摇杆
   - 触摸屏操作（手机/平板）

---

## 🔧 管理命令

```bash
# 查看服务状态
pm2 status

# 查看实时日志
pm2 logs wanxiang

# 重启服务
pm2 restart wanxiang

# 停止服务
pm2 stop wanxiang

# 启动服务
pm2 start wanxiang
```

---

## 🔄 更新部署

当你修改代码后：

```bash
# 1. 本地重新构建
npm run build
tar -czf wanxiang-blocks.tar.gz -C dist .

# 2. 上传新的压缩包到 /root/（覆盖旧文件）

# 3. 在服务器运行
cd /root/wanxiang
rm -rf *
tar -xzf /root/wanxiang-blocks.tar.gz
pm2 restart wanxiang
```

---

## 🐛 故障排查

### 问题1：404 错误

```bash
# 检查服务状态
pm2 status

# 查看日志
pm2 logs wanxiang --lines 50

# 重启服务
pm2 restart wanxiang
```

### 问题2：服务未启动

```bash
# 检查文件
ls -la /root/wanxiang/index.html

# 重新部署
cd /root/wanxiang
rm -rf *
tar -xzf /root/wanxiang-blocks.tar.gz
pm2 delete wanxiang
pm2 serve /root/wanxiang 6006 --spa --name wanxiang
pm2 save
```

### 问题3：端口问题

```bash
# 检查端口监听
ss -tlnp | grep 6006

# 或使用 lsof
lsof -i :6006

# 测试本地访问
curl -I http://localhost:6006
```

---

## 📱 分享你的作品

**访问地址：**
```
https://u812392-b4f4-d1b0eded.bjb1.seetacloud.com:8443
```

可以直接分享给朋友，支持：
- 💻 电脑浏览器
- 📱 手机浏览器
- 📋 平板浏览器
- ✋ 触摸屏设备

---

## 🎯 项目特色

- 🎨 **可视化编程** - 拖拽组件，搭建游戏
- 🧩 **逻辑积木** - 类 Scratch 的积木编程
- 🕹️ **虚拟摇杆** - 支持鼠标和触摸操作
- ⌨️ **键盘控制** - WASD 平滑移动
- 🤖 **AI 助手** - 自动生成游戏逻辑
- 🎮 **多种角色** - 玩家、敌人、NPC、道具等
- 🎬 **场景管理** - 多场景切换
- 📐 **背景图层** - 视差效果、多层背景

---

## 🌟 快速开始

1. **创建项目**
   - 点击"新建项目"
   - 输入项目名称

2. **添加场景**
   - 在场景管理中创建多个场景
   - 设置场景背景

3. **添加角色**
   - 从左侧组件库拖拽精灵
   - 选择角色类型（玩家/敌人/NPC）
   - 设置角色属性

4. **编辑逻辑**
   - 选中精灵 → 右侧"编辑"标签
   - 选择事件触发器（点击/按键/碰撞等）
   - 拖拽积木块组合逻辑

5. **添加虚拟摇杆**
   - 从"自定义"分类拖拽"虚拟摇杆"
   - 放置在左下角或右下角
   - 调整大小和透明度

6. **预览测试**
   - 点击顶部工具栏的"▶️ 预览"
   - 测试键盘和摇杆控制
   - 在手机上测试触摸操作

---

## 💡 使用技巧

### 键盘控制角色移动
1. 选中角色 → 右侧"AI助手"
2. 输入："通过WASD键控制移动"
3. 点击"生成逻辑积木"
4. 预览测试，按 WASD 移动

### 摇杆控制角色移动
1. 拖拽"虚拟摇杆"到画布
2. 在属性面板设置：
   - 控制目标：留空（自动控制玩家）
   - 移动速度：3-5
   - 摇杆大小：120
3. 预览测试，拖动摇杆移动

### 场景切换
1. 添加按钮组件
2. 选中按钮 → 右侧"AI助手"
3. 输入："点击后切换到下一个场景"
4. 生成积木，预览测试

---

## 🎉 完成！

**万象积木**现在运行在：
```
https://u812392-b4f4-d1b0eded.bjb1.seetacloud.com:8443
```

开始创作你的游戏世界吧！🚀
