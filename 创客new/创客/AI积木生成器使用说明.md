# AI 积木生成器配置完成 ✅

## 功能概述

已成功将 **AI 积木生成器** 集成到平台中！这是一个强大的智能辅助工具，可以通过自然语言描述自动生成游戏逻辑积木。

---

## 已完成的工作

### 1. ✅ 复制核心文件

**服务文件**：`src/services/aiBlockGenerator.ts`
- AI API 调用服务
- 积木生成逻辑
- 配置管理（localStorage持久化）

**组件文件**：`src/components/blocks/AIBlockGeneratorPanel.tsx`
- AI生成器UI面板
- API配置界面
- 示例提示词

### 2. ✅ 集成到右侧边栏

**添加了新的标签页**：
- 🤖 **AI助手** 标签页
- 位于右侧边栏（流程/编辑/样式/评论/AI助手）
- 独立面板，不干扰现有功能

**修改的文件**：
- `src/components/layout/RightSidebar.tsx` - 添加AI助手标签页
- `src/stores/uiStore.ts` - 更新类型定义

### 3. ✅ 数据流连接

- 使用现有的 `handleBlocksChange` 函数
- 生成的积木自动添加到当前事件触发器
- 与积木编辑器无缝集成

---

## 如何使用 AI 积木生成器

### 步骤 1：配置 AI API

首次使用需要配置 AI 服务：

1. **打开平台**：http://localhost:3003/
2. **选择组件**：在左侧选择一个游戏角色/组件
3. **切换到 AI助手 标签页**：右侧边栏 → 🤖 AI助手
4. **点击"设置"按钮**：配置 API

#### 支持的 AI 服务

平台已预设多个 AI 服务商：

| 服务商 | 特点 | 推荐指数 |
|--------|------|---------|
| **DeepSeek** | 便宜、中文友好、效果好 | ⭐⭐⭐⭐⭐ |
| AIPing 中转 | 中转服务，支持多模型 | ⭐⭐⭐⭐ |
| OpenAI | 官方服务，需要科学上网 | ⭐⭐⭐⭐ |
| 智谱 AI (GLM) | 国产大模型 | ⭐⭐⭐ |
| 月之暗面 (Kimi) | 长文本处理强 | ⭐⭐⭐ |
| 自定义 | 自定义API端点 | - |

#### 推荐配置（DeepSeek）

```
API 服务: DeepSeek
API Endpoint: https://api.deepseek.com/v1/chat/completions
API Key: 你的密钥（从 https://platform.deepseek.com 获取）
模型名称: deepseek-chat
```

**获取 API Key**：
1. 访问 https://platform.deepseek.com
2. 注册/登录
3. 创建 API Key
4. 复制密钥到平台

5. **测试连接**：点击"测试连接"按钮
6. **保存配置**：测试成功后点击"保存"

**注意**：配置是全局的，只需设置一次即可在所有组件中使用。

---

### 步骤 2：生成积木

1. **选择角色/组件**：在左侧选择要添加行为的组件
2. **描述行为**：在输入框中用自然语言描述游戏行为
3. **点击"生成"**：AI 自动生成积木
4. **查看结果**：生成的积木自动添加到"编辑"标签页中

---

## 使用示例

### 示例 1：角色移动

**输入**：
```
用WASD键控制角色移动
```

**AI 生成**：
```
当按键 [W] 按下时
  └─ 移动 X:0 Y:-5

当按键 [S] 按下时
  └─ 移动 X:0 Y:5

当按键 [A] 按下时
  └─ 移动 X:-5 Y:0

当按键 [D] 按下时
  └─ 移动 X:5 Y:0
```

### 示例 2：收集物品

**输入**：
```
碰到金币后得分并消失
```

**AI 生成**：
```
当碰撞发生时 [目标:coin]
  ├─ 增加分数 10
  ├─ 播放音效 "coin"
  └─ 销毁自己
```

### 示例 3：敌人巡逻

**输入**：
```
敌人自动左右巡逻
```

**AI 生成**：
```
当游戏开始时
  └─ 设置速度 vx:3 vy:0

当碰撞发生时 [目标:wall]
  └─ 设置速度 vx:-3 vy:0

永远循环
  └─ 如果 到墙边缘
      └─ 反转方向
```

### 示例 4：跳跃

**输入**：
```
按空格键跳跃
```

**AI 生成**：
```
当按键 [space] 按下时
  └─ 如果 在地面上
      └─ 施加力 fx:0 fy:-400
```

### 示例 5：生命系统

**输入**：
```
碰到敌人后扣血闪烁
```

**AI 生成**：
```
当碰撞发生时 [目标:enemy]
  ├─ 扣除生命 1
  ├─ 重复 5 次
  │   ├─ 设置透明度 0.3
  │   ├─ 等待 0.1秒
  │   ├─ 设置透明度 1
  │   └─ 等待 0.1秒
  └─ 如果 生命 = 0
      └─ 游戏结束
```

---

## 功能特点

### ✨ 智能理解

- 🧠 理解自然语言描述
- 🎯 自动选择合适的积木类型
- 🔗 生成完整的逻辑链

### 🎨 灵活生成

- **追加模式**：生成的积木添加到现有积木后面
- **重新生成**：替换所有现有积木（使用相同描述）
- **清空积木**：一键清空当前所有积木

### 📝 示例提示词

面板内置多个示例：
- 用WASD键控制角色移动
- 碰到金币后得分并消失
- 敌人自动左右巡逻
- 按空格键跳跃
- 碰到敌人后扣血闪烁

点击示例即可填充到输入框。

### ⚙️ 多服务支持

支持多个 AI 服务商，可根据需求切换：
- DeepSeek（推荐）：便宜、快速、中文友好
- OpenAI：功能强大，需要科学上网
- 智谱AI、Kimi：国产替代方案
- 自定义：支持任何兼容 OpenAI API 的服务

---

## 快捷键

- **Ctrl + Enter**（Mac: Cmd + Enter）：快速生成

---

## 注意事项

### 1. API 配置

- ✅ 配置是全局的，设置一次即可
- ✅ 保存在 localStorage，刷新后不会丢失
- ⚠️ 不要泄露 API Key

### 2. 生成质量

**影响因素**：
- 描述的清晰度（越详细越好）
- 选择的 AI 模型（DeepSeek 效果较好）
- 当前角色类型（player/enemy/npc/item）

**提升技巧**：
- 用具体的描述（如"用WASD移动"而不是"移动"）
- 一次描述一个行为（不要描述太多）
- 使用示例提示词作为参考

### 3. 生成后调整

- 生成的积木可以在"编辑"标签页中手动调整
- 参数可以根据需要修改
- 可以添加更多积木或删除不需要的

### 4. 成本

- 使用 AI 服务会消耗 API 额度
- DeepSeek 价格约为 ¥0.001-0.002/次生成
- 建议设置额度限制

---

## 测试建议

### 基础测试

1. ✅ 查看右侧边栏是否出现"🤖 AI助手"标签页
2. ✅ 切换到 AI助手，查看界面是否正常
3. ✅ 点击"设置"按钮，查看配置面板
4. ✅ 选择预设服务商（如 DeepSeek）

### 功能测试（需要 API Key）

1. ✅ 配置 API 并测试连接
2. ✅ 输入简单描述（如"向右移动"）
3. ✅ 点击"生成"，查看是否生成积木
4. ✅ 切换到"编辑"标签页，查看生成的积木
5. ✅ 测试"重新生成"和"清空"功能
6. ✅ 尝试不同的示例提示词

---

## 故障排除

### Q: 找不到 AI助手 标签页？
A: 确保服务器正在运行，刷新页面。标签页在右侧边栏最右边。

### Q: 生成失败？
A: 检查：
1. API Key 是否正确
2. 网络连接是否正常
3. API 额度是否充足
4. 使用"测试连接"功能诊断

### Q: 生成的积木不符合预期？
A: 尝试：
1. 更详细地描述行为
2. 参考示例提示词的格式
3. 使用"重新生成"功能多次尝试
4. 生成后手动调整积木

### Q: 配置保存后丢失？
A: 配置保存在 localStorage，清除浏览器缓存会丢失。请重新配置。

---

## 开发状态

- ✅ AI 服务集成完成
- ✅ UI 面板集成完成
- ✅ 数据流连接完成
- ✅ 代码编译通过
- ✅ 热更新成功

---

## 文件清单

**新增/复制的文件**：
1. `src/services/aiBlockGenerator.ts` - AI 服务
2. `src/components/blocks/AIBlockGeneratorPanel.tsx` - AI 面板组件

**修改的文件**：
1. `src/components/layout/RightSidebar.tsx` - 添加标签页
2. `src/stores/uiStore.ts` - 更新类型定义

---

## 后续优化建议

可选的增强功能（暂未实现）：

1. 🎨 **样式优化**：调整面板布局和视觉效果
2. 💾 **历史记录**：保存生成历史，支持快速重用
3. 🔄 **批量生成**：一次性为多个组件生成行为
4. 📊 **使用统计**：显示生成次数、成功率等
5. 🌐 **更多模型**：支持更多 AI 服务商

---

服务器运行在：**http://localhost:3003/**

现在可以测试 AI 积木生成器功能了！🎉
