# 独立游戏开发平台架构

## 概述

这是一个**完全独立**的游戏开发平台，不依赖任何特定的游戏引擎。可以：

1. **独立运行** - 作为 Web 应用直接运行
2. **嵌入集成** - 作为组件嵌入到任何平台
3. **跨平台** - 支持 Web、Electron、移动端
4. **通用格式** - 使用标准的 JSON 格式存储项目

## 核心架构

### 1. 应用层次

```
┌─────────────────────────────────────────────────────┐
│                   应用入口层                          │
│  - Web App (浏览器)                                  │
│  - Electron App (桌面)                               │
│  - 嵌入式组件 (iframe/Web Component)                 │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│                   UI 组件层                          │
│  - ThreeColumnLayout (三栏布局)                      │
│  - ProjectNavigator (项目导航)                       │
│  - SceneEditor (场景编辑器)                          │
│  - ResourcePanel (资源面板)                          │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│                   业务逻辑层                          │
│  - ProjectManager (项目管理)                         │
│  - ResourceManager (资源管理)                        │
│  - SceneManager (场景管理)                           │
│  - EventManager (事件管理)                           │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│                   数据存储层                          │
│  - LocalStorage (浏览器存储)                         │
│  - IndexedDB (大文件存储)                            │
│  - File System (本地文件系统)                        │
│  - Cloud Storage (云存储 - 可选)                     │
└─────────────────────────────────────────────────────┘
```

### 2. 模块设计

#### 核心模块

| 模块 | 功能 | 独立性 |
|------|------|--------|
| **ProjectManager** | 项目创建、保存、加载、导出 | ✅ 完全独立 |
| **ResourceManager** | 资源上传、管理、分类 | ✅ 完全独立 |
| **SceneEditor** | 场景可视化编辑 | ✅ 完全独立 |
| **ObjectEditor** | 游戏对象编辑 | ✅ 完全独立 |
| **EventEditor** | 事件逻辑编辑 | ✅ 完全独立 |
| **PreviewEngine** | 游戏预览运行 | ✅ 完全独立 |

#### 可选模块

| 模块 | 功能 | 说明 |
|------|------|------|
| **PhysicsEngine** | 物理引擎 | 可选集成 Matter.js |
| **AudioEngine** | 音频引擎 | 可选集成 Howler.js |
| **RenderEngine** | 渲染引擎 | 可选集成 PixiJS/Three.js |

## 数据格式

### 项目文件格式 (.gameproject)

```json
{
  "version": "1.0.0",
  "metadata": {
    "projectId": "unique-id",
    "name": "我的游戏",
    "description": "游戏描述",
    "gameType": "action",
    "tags": ["2D", "像素风"],
    "thumbnail": "data:image/png;base64,...",
    "createdAt": "2026-01-23T00:00:00Z",
    "updatedAt": "2026-01-23T00:00:00Z"
  },
  "settings": {
    "width": 1280,
    "height": 720,
    "backgroundColor": "#000000",
    "fps": 60
  },
  "resources": [
    {
      "id": "res_001",
      "name": "player_sprite",
      "type": "image",
      "path": "assets/player.png",
      "metadata": {
        "width": 64,
        "height": 64
      }
    }
  ],
  "scenes": [
    {
      "id": "scene_001",
      "name": "主场景",
      "objects": [],
      "layers": []
    }
  ],
  "objects": [
    {
      "id": "obj_001",
      "name": "玩家",
      "type": "sprite",
      "properties": {}
    }
  ],
  "events": []
}
```

## 使用方式

### 方式1：独立 Web 应用

```bash
# 安装依赖
npm install

# 启动开发服务器
npm start

# 构建生产版本
npm build
```

访问 `http://localhost:3000` 即可使用。

### 方式2：嵌入到网页

```html
<!DOCTYPE html>
<html>
<head>
  <title>游戏开发平台</title>
</head>
<body>
  <div id="game-creator-root"></div>
  <script src="game-creator.bundle.js"></script>
  <script>
    GameCreator.init({
      container: '#game-creator-root',
      config: {
        // 配置选项
      }
    });
  </script>
</body>
</html>
```

### 方式3：作为 React 组件

```javascript
import GameCreatorPlatform from 'game-creator-platform';

function App() {
  return (
    <div>
      <GameCreatorPlatform
        onProjectSave={(project) => {
          console.log('项目已保存', project);
        }}
        onProjectLoad={(projectId) => {
          console.log('加载项目', projectId);
        }}
      />
    </div>
  );
}
```

### 方式4：Electron 桌面应用

```javascript
// main.js
const { app, BrowserWindow } = require('electron');

function createWindow() {
  const win = new BrowserWindow({
    width: 1600,
    height: 900,
    webPreferences: {
      nodeIntegration: true
    }
  });

  win.loadFile('index.html');
}

app.whenReady().then(createWindow);
```

## 集成到其他平台

### 集成到 Unity

```csharp
// 使用 WebView 嵌入
public class GameCreatorIntegration : MonoBehaviour
{
    private WebView webView;

    void Start()
    {
        webView = gameObject.AddComponent<WebView>();
        webView.LoadURL("http://localhost:3000");
    }
}
```

### 集成到 Unreal Engine

```cpp
// 使用 Web Browser Widget
UWebBrowser* WebBrowser = CreateWidget<UWebBrowser>(this, UWebBrowser::StaticClass());
WebBrowser->LoadURL("http://localhost:3000");
```

### 集成到微信小程序

```javascript
// 使用 web-view 组件
<web-view src="https://your-domain.com/game-creator"></web-view>
```

### 集成到移动应用 (React Native)

```javascript
import { WebView } from 'react-native-webview';

function GameCreatorScreen() {
  return (
    <WebView
      source={{ uri: 'http://localhost:3000' }}
      style={{ flex: 1 }}
    />
  );
}
```

## API 接口

### 初始化

```javascript
GameCreator.init({
  container: '#root',
  config: {
    language: 'zh-CN',
    theme: 'light',
    storage: 'localStorage', // 或 'indexedDB', 'fileSystem'
  },
  callbacks: {
    onProjectCreate: (project) => {},
    onProjectSave: (project) => {},
    onProjectLoad: (project) => {},
    onProjectExport: (data) => {},
  }
});
```

### 项目管理

```javascript
// 创建项目
const project = await GameCreator.createProject({
  name: '我的游戏',
  gameType: 'action',
});

// 保存项目
await GameCreator.saveProject(project);

// 加载项目
const loadedProject = await GameCreator.loadProject(projectId);

// 导出项目
const exportData = await GameCreator.exportProject(projectId, {
  format: 'json', // 或 'zip'
});

// 导入项目
await GameCreator.importProject(fileData);
```

### 资源管理

```javascript
// 上传资源
const resource = await GameCreator.uploadResource({
  file: fileObject,
  type: 'image',
  name: 'player_sprite',
});

// 获取资源列表
const resources = await GameCreator.getResources({
  type: 'image',
  tags: ['character'],
});

// 删除资源
await GameCreator.deleteResource(resourceId);
```

### 场景管理

```javascript
// 创建场景
const scene = await GameCreator.createScene({
  name: '主场景',
  width: 1280,
  height: 720,
});

// 添加对象到场景
await GameCreator.addObjectToScene(sceneId, {
  type: 'sprite',
  x: 100,
  y: 100,
  resourceId: 'res_001',
});
```

## 扩展性

### 插件系统

```javascript
// 注册插件
GameCreator.registerPlugin({
  name: 'my-plugin',
  version: '1.0.0',
  init: (api) => {
    // 插件初始化
    api.addMenuItem({
      label: '我的功能',
      onClick: () => {
        // 功能实现
      }
    });
  }
});
```

### 自定义编辑器

```javascript
// 注册自定义编辑器
GameCreator.registerEditor({
  type: 'custom-object',
  component: MyCustomEditor,
  icon: 'custom-icon',
  label: '自定义对象',
});
```

## 部署方式

### 1. 静态网站部署

```bash
npm run build
# 将 build/ 目录部署到任何静态服务器
```

支持的平台：
- Vercel
- Netlify
- GitHub Pages
- 阿里云 OSS
- 腾讯云 COS

### 2. Docker 部署

```dockerfile
FROM node:16-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "start"]
```

### 3. Electron 打包

```bash
npm install electron-builder --save-dev
npm run build
electron-builder
```

## 数据持久化方案

### 浏览器环境

1. **LocalStorage** - 小型项目（< 5MB）
2. **IndexedDB** - 中型项目（< 50MB）
3. **File System Access API** - 大型项目（无限制）

### 桌面环境

1. **本地文件系统** - 直接读写文件
2. **SQLite** - 结构化数据存储

### 云端环境

1. **REST API** - 与后端服务通信
2. **WebSocket** - 实时协作
3. **云存储** - 大文件存储

## 性能优化

1. **懒加载** - 按需加载编辑器组件
2. **虚拟滚动** - 大量资源列表优化
3. **Web Worker** - 后台处理任务
4. **缓存策略** - 资源缓存和预加载

## 安全性

1. **输入验证** - 防止 XSS 攻击
2. **文件类型检查** - 限制上传文件类型
3. **大小限制** - 防止资源过大
4. **沙箱运行** - 游戏预览在沙箱中运行

## 总结

这个独立的游戏开发平台具有以下特点：

✅ **完全独立** - 不依赖任何特定引擎
✅ **跨平台** - Web、桌面、移动端
✅ **易集成** - 可嵌入任何平台
✅ **可扩展** - 插件系统支持
✅ **标准格式** - JSON 项目文件
✅ **开源友好** - MIT 许可证

可以作为：
- 独立的 Web 应用
- 嵌入式组件
- Electron 桌面应用
- 移动应用的一部分
- 其他平台的集成模块
