# 使用示例

本文档展示如何在不同场景下使用游戏创建平台。

## 1. 独立 Web 应用

### 安装和运行

```bash
# 克隆或复制项目到本地
cd E:\创客

# 安装依赖
npm install

# 启动开发服务器
npm start

# 浏览器自动打开 http://localhost:3000
```

### 构建生产版本

```bash
# 构建
npm run build

# 构建产物在 build/ 目录
# 可以部署到任何静态服务器
```

## 2. 嵌入到现有网页

### 方式 A：使用 CDN

```html
<!DOCTYPE html>
<html>
<head>
  <title>我的网站 - 游戏创建</title>
</head>
<body>
  <div id="game-creator-root"></div>

  <!-- 引入构建后的 JS 文件 -->
  <script src="https://your-cdn.com/game-creator.js"></script>

  <script>
    // 初始化平台
    GameCreator.init({
      container: '#game-creator-root',
      config: {
        language: 'zh-CN',
        theme: 'light',
      },
      callbacks: {
        // 项目创建
        onProjectCreate: async (metadata) => {
          const projectId = 'project_' + Date.now();
          const project = {
            ...metadata,
            projectId,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString(),
            lastOpened: new Date().toISOString(),
          };

          // 保存到本地存储
          localStorage.setItem(`project_${projectId}`, JSON.stringify(project));

          return project;
        },

        // 项目保存
        onProjectSave: async (project) => {
          project.updatedAt = new Date().toISOString();
          localStorage.setItem(`project_${project.projectId}`, JSON.stringify(project));
          console.log('项目已保存:', project.name);
          return project;
        },

        // 项目加载
        onProjectLoad: async (projectId) => {
          const data = localStorage.getItem(`project_${projectId}`);
          if (!data) {
            throw new Error('项目不存在');
          }
          return JSON.parse(data);
        },

        // 获取项目列表
        onGetProjects: async (filters) => {
          const projects = [];
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && key.startsWith('project_')) {
              const data = localStorage.getItem(key);
              if (data) {
                projects.push(JSON.parse(data));
              }
            }
          }
          return projects;
        },

        // 资源上传
        onUploadResource: async (resource) => {
          // 处理文件上传
          const reader = new FileReader();
          return new Promise((resolve) => {
            reader.onload = (e) => {
              const resourceData = {
                id: 'res_' + Date.now(),
                name: resource.name,
                type: resource.type,
                data: e.target.result,
                uploadedAt: new Date().toISOString(),
              };
              resolve(resourceData);
            };
            reader.readAsDataURL(resource.file);
          });
        },
      }
    });
  </script>
</body>
</html>
```

### 方式 B：使用 iframe

```html
<!DOCTYPE html>
<html>
<head>
  <title>嵌入游戏创建平台</title>
  <style>
    #game-creator-frame {
      width: 100%;
      height: 100vh;
      border: none;
    }
  </style>
</head>
<body>
  <iframe
    id="game-creator-frame"
    src="http://localhost:3000"
    allow="fullscreen"
  ></iframe>

  <script>
    // 与 iframe 通信
    const frame = document.getElementById('game-creator-frame');

    window.addEventListener('message', (event) => {
      if (event.data.type === 'PROJECT_SAVED') {
        console.log('项目已保存:', event.data.project);
      }
    });

    // 发送消息到 iframe
    frame.contentWindow.postMessage({
      type: 'LOAD_PROJECT',
      projectId: 'project_123'
    }, '*');
  </script>
</body>
</html>
```

## 3. 作为 React 组件使用

### 安装

```bash
npm install game-creator-platform
```

### 使用

```javascript
import React from 'react';
import GameCreatorPlatform from 'game-creator-platform';

function MyApp() {
  const handleProjectSave = (project) => {
    console.log('项目已保存:', project);
    // 发送到后端 API
    fetch('/api/projects', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(project),
    });
  };

  const handleProjectLoad = async (projectId) => {
    // 从后端 API 加载
    const response = await fetch(`/api/projects/${projectId}`);
    return await response.json();
  };

  return (
    <div style={{ width: '100vw', height: '100vh' }}>
      <GameCreatorPlatform
        config={{
          language: 'zh-CN',
          theme: 'light',
        }}
        callbacks={{
          onProjectSave: handleProjectSave,
          onProjectLoad: handleProjectLoad,
          onProjectCreate: async (metadata) => {
            const response = await fetch('/api/projects', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(metadata),
            });
            return await response.json();
          },
        }}
      />
    </div>
  );
}

export default MyApp;
```

## 4. Electron 桌面应用

### main.js

```javascript
const { app, BrowserWindow, ipcMain } = require('electron');
const path = require('path');
const fs = require('fs').promises;

let mainWindow;

function createWindow() {
  mainWindow = new BrowserWindow({
    width: 1600,
    height: 900,
    webPreferences: {
      nodeIntegration: true,
      contextIsolation: false,
    },
  });

  // 加载应用
  mainWindow.loadFile('build/index.html');

  // 打开开发者工具
  // mainWindow.webContents.openDevTools();
}

// 处理项目保存
ipcMain.handle('save-project', async (event, project) => {
  const projectPath = path.join(app.getPath('userData'), 'projects', `${project.projectId}.json`);
  await fs.mkdir(path.dirname(projectPath), { recursive: true });
  await fs.writeFile(projectPath, JSON.stringify(project, null, 2));
  return { success: true };
});

// 处理项目加载
ipcMain.handle('load-project', async (event, projectId) => {
  const projectPath = path.join(app.getPath('userData'), 'projects', `${projectId}.json`);
  const data = await fs.readFile(projectPath, 'utf-8');
  return JSON.parse(data);
});

// 处理项目列表
ipcMain.handle('list-projects', async () => {
  const projectsDir = path.join(app.getPath('userData'), 'projects');
  try {
    const files = await fs.readdir(projectsDir);
    const projects = [];
    for (const file of files) {
      if (file.endsWith('.json')) {
        const data = await fs.readFile(path.join(projectsDir, file), 'utf-8');
        projects.push(JSON.parse(data));
      }
    }
    return projects;
  } catch (error) {
    return [];
  }
});

app.whenReady().then(createWindow);

app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') {
    app.quit();
  }
});

app.on('activate', () => {
  if (BrowserWindow.getAllWindows().length === 0) {
    createWindow();
  }
});
```

### preload.js (在 index.html 中使用)

```javascript
const { ipcRenderer } = require('electron');

// 初始化平台
window.addEventListener('DOMContentLoaded', () => {
  window.GameCreator.init({
    container: '#root',
    config: {
      language: 'zh-CN',
      theme: 'light',
    },
    callbacks: {
      onProjectSave: async (project) => {
        return await ipcRenderer.invoke('save-project', project);
      },
      onProjectLoad: async (projectId) => {
        return await ipcRenderer.invoke('load-project', projectId);
      },
      onGetProjects: async () => {
        return await ipcRenderer.invoke('list-projects');
      },
    },
  });
});
```

### package.json (Electron)

```json
{
  "name": "game-creator-desktop",
  "version": "1.0.0",
  "main": "main.js",
  "scripts": {
    "start": "electron .",
    "build": "electron-builder"
  },
  "devDependencies": {
    "electron": "^25.0.0",
    "electron-builder": "^24.0.0"
  },
  "build": {
    "appId": "com.gamecreator.app",
    "productName": "游戏创建平台",
    "directories": {
      "output": "dist"
    },
    "files": [
      "build/**/*",
      "main.js"
    ],
    "win": {
      "target": "nsis",
      "icon": "build/icon.ico"
    },
    "mac": {
      "target": "dmg",
      "icon": "build/icon.icns"
    },
    "linux": {
      "target": "AppImage",
      "icon": "build/icon.png"
    }
  }
}
```

## 5. 与后端 API 集成

### 前端代码

```javascript
class ProjectAPI {
  constructor(baseURL) {
    this.baseURL = baseURL;
  }

  async createProject(metadata) {
    const response = await fetch(`${this.baseURL}/projects`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${this.getToken()}`,
      },
      body: JSON.stringify(metadata),
    });
    return await response.json();
  }

  async saveProject(project) {
    const response = await fetch(`${this.baseURL}/projects/${project.projectId}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${this.getToken()}`,
      },
      body: JSON.stringify(project),
    });
    return await response.json();
  }

  async loadProject(projectId) {
    const response = await fetch(`${this.baseURL}/projects/${projectId}`, {
      headers: {
        'Authorization': `Bearer ${this.getToken()}`,
      },
    });
    return await response.json();
  }

  async uploadResource(file) {
    const formData = new FormData();
    formData.append('file', file);

    const response = await fetch(`${this.baseURL}/resources`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${this.getToken()}`,
      },
      body: formData,
    });
    return await response.json();
  }

  getToken() {
    return localStorage.getItem('auth_token');
  }
}

// 使用
const api = new ProjectAPI('https://api.example.com');

GameCreator.init({
  container: '#root',
  callbacks: {
    onProjectCreate: (metadata) => api.createProject(metadata),
    onProjectSave: (project) => api.saveProject(project),
    onProjectLoad: (projectId) => api.loadProject(projectId),
    onUploadResource: (resource) => api.uploadResource(resource.file),
  },
});
```

### 后端 API 示例 (Node.js + Express)

```javascript
const express = require('express');
const multer = require('multer');
const app = express();

app.use(express.json());

// 配置文件上传
const upload = multer({ dest: 'uploads/' });

// 创建项目
app.post('/api/projects', async (req, res) => {
  const project = {
    ...req.body,
    projectId: 'project_' + Date.now(),
    createdAt: new Date().toISOString(),
  };

  // 保存到数据库
  await db.projects.insert(project);

  res.json(project);
});

// 保存项目
app.put('/api/projects/:id', async (req, res) => {
  const { id } = req.params;
  const project = {
    ...req.body,
    updatedAt: new Date().toISOString(),
  };

  await db.projects.update({ projectId: id }, project);

  res.json(project);
});

// 加载项目
app.get('/api/projects/:id', async (req, res) => {
  const { id } = req.params;
  const project = await db.projects.findOne({ projectId: id });

  if (!project) {
    return res.status(404).json({ error: '项目不存在' });
  }

  res.json(project);
});

// 上传资源
app.post('/api/resources', upload.single('file'), async (req, res) => {
  const resource = {
    id: 'res_' + Date.now(),
    filename: req.file.filename,
    originalName: req.file.originalname,
    mimetype: req.file.mimetype,
    size: req.file.size,
    url: `/uploads/${req.file.filename}`,
  };

  await db.resources.insert(resource);

  res.json(resource);
});

app.listen(3001, () => {
  console.log('API server running on port 3001');
});
```

## 6. 移动端集成 (React Native)

```javascript
import React from 'react';
import { WebView } from 'react-native-webview';
import { View, StyleSheet } from 'react-native';

function GameCreatorScreen() {
  const handleMessage = (event) => {
    const data = JSON.parse(event.nativeEvent.data);

    if (data.type === 'PROJECT_SAVED') {
      console.log('项目已保存:', data.project);
    }
  };

  const injectedJavaScript = `
    window.GameCreator.init({
      container: '#root',
      config: {
        language: 'zh-CN',
        theme: 'light',
      },
      callbacks: {
        onProjectSave: (project) => {
          window.ReactNativeWebView.postMessage(JSON.stringify({
            type: 'PROJECT_SAVED',
            project: project
          }));
        }
      }
    });
  `;

  return (
    <View style={styles.container}>
      <WebView
        source={{ uri: 'http://localhost:3000' }}
        style={styles.webview}
        onMessage={handleMessage}
        injectedJavaScript={injectedJavaScript}
      />
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
  webview: {
    flex: 1,
  },
});

export default GameCreatorScreen;
```

## 7. 微信小程序集成

```javascript
// pages/game-creator/game-creator.wxml
<web-view src="{{webviewUrl}}" bindmessage="handleMessage"></web-view>

// pages/game-creator/game-creator.js
Page({
  data: {
    webviewUrl: 'https://your-domain.com/game-creator'
  },

  handleMessage(e) {
    const data = e.detail.data[0];

    if (data.type === 'PROJECT_SAVED') {
      wx.showToast({
        title: '项目已保存',
        icon: 'success'
      });
    }
  }
});
```

## 总结

游戏创建平台支持多种集成方式：

1. ✅ **独立 Web 应用** - 直接运行
2. ✅ **嵌入网页** - iframe 或 CDN
3. ✅ **React 组件** - npm 包
4. ✅ **Electron 桌面应用** - 跨平台桌面
5. ✅ **后端 API** - RESTful API
6. ✅ **移动端** - React Native
7. ✅ **小程序** - 微信小程序

选择最适合您项目的集成方式！
