# GDevelop é›†æˆæŒ‡å—

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜å¦‚ä½•å°†æ¸¸æˆé¡¹ç›®ç®¡ç†åŠŸèƒ½é›†æˆåˆ°ç°æœ‰çš„ GDevelop é¡¹ç›®ä¸­ã€‚

## é›†æˆæ¦‚è¿°

é›†æˆå·¥ä½œåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

1. å¤åˆ¶æºä»£ç æ–‡ä»¶
2. ä¿®æ”¹ MainFrame ç»„ä»¶
3. ä¿®æ”¹é¡¹ç›®åŠ è½½é€»è¾‘
4. æ·»åŠ é¡¹ç›®å…ƒæ•°æ®ç®¡ç†åŠŸèƒ½
5. æ·»åŠ èœå•é¡¹å’Œå¿«æ·é”®

## ç¬¬ä¸€æ­¥ï¼šå¤åˆ¶æºä»£ç æ–‡ä»¶

### 1.1 åˆ›å»ºç›®å½•ç»“æ„

åœ¨ GDevelop é¡¹ç›®çš„ `newIDE/app/src/` ç›®å½•ä¸‹åˆ›å»ºä»¥ä¸‹ç»“æ„ï¼š

```bash
cd newIDE/app/src
mkdir -p GameProjectManager/ProjectNavigator
mkdir -p GameProjectManager/CategoryManager
mkdir -p GameProjectManager/ResourceClassifier
mkdir -p GameProjectManager/ProjectMetadata
mkdir -p NewLayout
mkdir -p Utils
```

### 1.2 å¤åˆ¶æ–‡ä»¶

å°†æœ¬é¡¹ç›®çš„ä»¥ä¸‹æ–‡ä»¶å¤åˆ¶åˆ°å¯¹åº”ç›®å½•ï¼š

| æºæ–‡ä»¶ | ç›®æ ‡ä½ç½® |
|--------|----------|
| `src/GameProjectManager/types.js` | `newIDE/app/src/GameProjectManager/types.js` |
| `src/GameProjectManager/constants.js` | `newIDE/app/src/GameProjectManager/constants.js` |
| `src/GameProjectManager/ProjectNavigator/ProjectNavigator.js` | `newIDE/app/src/GameProjectManager/ProjectNavigator/ProjectNavigator.js` |
| `src/GameProjectManager/ProjectMetadata/MetadataStorage.js` | `newIDE/app/src/GameProjectManager/ProjectMetadata/MetadataStorage.js` |
| `src/NewLayout/ThreeColumnLayout.js` | `newIDE/app/src/NewLayout/ThreeColumnLayout.js` |
| `src/NewLayout/ResourcePanel.js` | `newIDE/app/src/NewLayout/ResourcePanel.js` |
| `src/Utils/ProjectClassifier.js` | `newIDE/app/src/Utils/ProjectClassifier.js` |
| `src/Utils/ResourceAnalyzer.js` | `newIDE/app/src/Utils/ResourceAnalyzer.js` |

## ç¬¬äºŒæ­¥ï¼šä¿®æ”¹ MainFrame

### 2.1 å¯¼å…¥æ–°ç»„ä»¶

åœ¨ `newIDE/app/src/MainFrame/index.js` çš„å¯¼å…¥éƒ¨åˆ†æ·»åŠ ï¼š

```javascript
// åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ 
import ThreeColumnLayout from '../NewLayout/ThreeColumnLayout';
import ProjectNavigator from '../GameProjectManager/ProjectNavigator/ProjectNavigator';
import ResourcePanel from '../NewLayout/ResourcePanel';
import MetadataStorage from '../GameProjectManager/ProjectMetadata/MetadataStorage';
import ResourceAnalyzer from '../Utils/ResourceAnalyzer';
import ProjectClassifier from '../Utils/ProjectClassifier';
```

### 2.2 æ·»åŠ çŠ¶æ€ç®¡ç†

åœ¨ MainFrame ç»„ä»¶ä¸­æ·»åŠ æ–°çš„çŠ¶æ€ï¼š

```javascript
type State = {
  // ... ç°æœ‰çŠ¶æ€ ...

  // æ–°å¢çŠ¶æ€
  leftPanelOpen: boolean,
  rightPanelOpen: boolean,
  projects: Array<ProjectMetadata>,
  categories: Array<Category>,
  currentProjectMetadata: ProjectMetadata | null,
  currentResourceTab: string,
  resourceViewMode: ViewMode,
  resourceFilterOptions: FilterOptions,
};

class MainFrame extends Component<Props, State> {
  state = {
    // ... ç°æœ‰çŠ¶æ€åˆå§‹åŒ– ...

    // æ–°å¢çŠ¶æ€åˆå§‹åŒ–
    leftPanelOpen: true,
    rightPanelOpen: true,
    projects: [],
    categories: [],
    currentProjectMetadata: null,
    currentResourceTab: 'resources',
    resourceViewMode: 'grid',
    resourceFilterOptions: {},
  };

  // ... ç»„ä»¶æ–¹æ³• ...
}
```

### 2.3 æ·»åŠ ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

```javascript
componentDidMount() {
  // ... ç°æœ‰ä»£ç  ...

  // åŠ è½½é¡¹ç›®å…ƒæ•°æ®å’Œåˆ†ç±»
  this._loadProjectMetadata();
}

_loadProjectMetadata() {
  const projects = MetadataStorage.getAllProjects();
  const categories = MetadataStorage.getAllCategories();
  this.setState({
    projects,
    categories,
  });
}
```

### 2.4 æ·»åŠ äº‹ä»¶å¤„ç†æ–¹æ³•

```javascript
// é¡¹ç›®é€‰æ‹©
handleProjectSelect = (projectId: string) => {
  const project = MetadataStorage.getProject(projectId);
  if (project && project.projectPath) {
    // æ‰“å¼€é¡¹ç›®
    this._openProjectWithPath(project.projectPath);
  }
};

// é¡¹ç›®æ”¶è—åˆ‡æ¢
handleProjectFavorite = (projectId: string) => {
  MetadataStorage.toggleFavorite(projectId);
  this._loadProjectMetadata();
};

// æ·»åŠ åˆ†ç±»
handleCategoryAdd = () => {
  // æ˜¾ç¤ºåˆ†ç±»æ·»åŠ å¯¹è¯æ¡†
  // å¯ä»¥ä½¿ç”¨ Material-UI çš„ Dialog
  const newCategory = {
    categoryId: `cat_${Date.now()}`,
    name: 'æ–°åˆ†ç±»',
    icon: 'ğŸ“',
    color: '#2196F3',
    order: this.state.categories.length,
  };
  MetadataStorage.saveCategory(newCategory);
  this._loadProjectMetadata();
};

// ç¼–è¾‘åˆ†ç±»
handleCategoryEdit = (categoryId: string) => {
  // æ˜¾ç¤ºåˆ†ç±»ç¼–è¾‘å¯¹è¯æ¡†
  const category = this.state.categories.find(c => c.categoryId === categoryId);
  if (category) {
    // æ›´æ–°åˆ†ç±»
    const updatedCategory = { ...category, name: 'æ›´æ–°çš„åç§°' };
    MetadataStorage.saveCategory(updatedCategory);
    this._loadProjectMetadata();
  }
};

// é¢æ¿åˆ‡æ¢
handleLeftPanelToggle = () => {
  this.setState(prevState => ({ leftPanelOpen: !prevState.leftPanelOpen }));
};

handleRightPanelToggle = () => {
  this.setState(prevState => ({ rightPanelOpen: !prevState.rightPanelOpen }));
};

// èµ„æºæ ‡ç­¾é¡µåˆ‡æ¢
handleResourceTabChange = (tab: string) => {
  this.setState({ currentResourceTab: tab });
};

// è§†å›¾æ¨¡å¼åˆ‡æ¢
handleViewModeChange = (mode: ViewMode) => {
  this.setState({ resourceViewMode: mode });
};

// ç­›é€‰é€‰é¡¹å˜åŒ–
handleFilterChange = (filters: FilterOptions) => {
  this.setState({ resourceFilterOptions: filters });
};
```

### 2.5 ä¿®æ”¹é¡¹ç›®æ‰“å¼€é€»è¾‘

æ‰¾åˆ° `_openProjectWithPath` æˆ–ç±»ä¼¼çš„é¡¹ç›®æ‰“å¼€æ–¹æ³•ï¼Œæ·»åŠ å…ƒæ•°æ®åŒæ­¥ï¼š

```javascript
_openProjectWithPath = (projectPath: string) => {
  return this._projectFileOpener
    .openProject(projectPath)
    .then(gdProject => {
      // ... ç°æœ‰ä»£ç  ...

      // åŒæ­¥/åˆ›å»ºé¡¹ç›®å…ƒæ•°æ®
      this._syncProjectMetadata(gdProject, projectPath);

      return gdProject;
    })
    .catch(error => {
      // ... é”™è¯¯å¤„ç† ...
    });
};

_syncProjectMetadata = (gdProject: any, projectPath: string) => {
  let metadata = MetadataStorage.getProject(projectPath);

  // åˆ†æèµ„æº
  const resourceAnalysis = ResourceAnalyzer.analyzeProjectResources(gdProject);

  if (!metadata) {
    // åˆ›å»ºæ–°å…ƒæ•°æ®
    metadata = {
      projectId: projectPath,
      name: gdProject.getName() || 'æœªå‘½åé¡¹ç›®',
      description: gdProject.getDescription() || '',
      gameType: 'other',
      tags: [],
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString(),
      lastOpened: new Date().toISOString(),
      favorite: false,
      category: 'æˆ‘çš„é¡¹ç›®',
      resources: resourceAnalysis,
      projectPath: projectPath,
    };
  } else {
    // æ›´æ–°ç°æœ‰å…ƒæ•°æ®
    metadata.lastOpened = new Date().toISOString();
    metadata.updatedAt = new Date().toISOString();
    metadata.name = gdProject.getName() || metadata.name;
    metadata.description = gdProject.getDescription() || metadata.description;
    metadata.resources = resourceAnalysis;
  }

  MetadataStorage.saveProject(metadata);

  // æ›´æ–°å½“å‰é¡¹ç›®å…ƒæ•°æ®çŠ¶æ€
  this.setState({ currentProjectMetadata: metadata });

  // é‡æ–°åŠ è½½é¡¹ç›®åˆ—è¡¨
  this._loadProjectMetadata();
};
```

### 2.6 ä¿®æ”¹æ¸²æŸ“æ–¹æ³•

æ‰¾åˆ° `render` æ–¹æ³•ï¼Œç”¨æ–°çš„ä¸‰æ å¸ƒå±€æ›¿æ¢ç°æœ‰å¸ƒå±€ï¼š

```javascript
render() {
  const { leftPanelOpen, rightPanelOpen, projects, categories } = this.state;

  return (
    <ThreeColumnLayout
      leftPanel={
        <ProjectNavigator
          projects={projects}
          categories={categories}
          selectedProjectId={this.state.currentProjectMetadata?.projectId}
          onProjectSelect={this.handleProjectSelect}
          onProjectFavorite={this.handleProjectFavorite}
          onCategoryAdd={this.handleCategoryAdd}
          onCategoryEdit={this.handleCategoryEdit}
        />
      }
      centerPanel={
        <div style={{ display: 'flex', flexDirection: 'column', height: '100%' }}>
          {/* ç°æœ‰çš„ EditorTabsPane */}
          <EditorTabsPane
            {...this._getEditorTabsPaneProps()}
          />
        </div>
      }
      rightPanel={
        <ResourcePanel
          resourcesTab={this._renderResourcesTab()}
          objectsTab={this._renderObjectsTab()}
          layersTab={this._renderLayersTab()}
          propertiesTab={this._renderPropertiesTab()}
          currentTab={this.state.currentResourceTab}
          onTabChange={this.handleResourceTabChange}
          filterOptions={this.state.resourceFilterOptions}
          onFilterChange={this.handleFilterChange}
          viewMode={this.state.resourceViewMode}
          onViewModeChange={this.handleViewModeChange}
        />
      }
      leftPanelOpen={leftPanelOpen}
      rightPanelOpen={rightPanelOpen}
      onLeftPanelToggle={this.handleLeftPanelToggle}
      onRightPanelToggle={this.handleRightPanelToggle}
    />
  );
}
```

### 2.7 æ·»åŠ å³ä¾§é¢æ¿æ¸²æŸ“æ–¹æ³•

```javascript
_renderResourcesTab() {
  // è¿”å›ç°æœ‰çš„èµ„æºåˆ—è¡¨ç»„ä»¶
  return <ResourcesList {...this._getResourcesListProps()} />;
}

_renderObjectsTab() {
  // è¿”å›ç°æœ‰çš„å¯¹è±¡åˆ—è¡¨ç»„ä»¶
  return <ObjectsList {...this._getObjectsListProps()} />;
}

_renderLayersTab() {
  // è¿”å›ç°æœ‰çš„å›¾å±‚åˆ—è¡¨ç»„ä»¶
  return <LayersList {...this._getLayersListProps()} />;
}

_renderPropertiesTab() {
  // è¿”å›ç°æœ‰çš„å±æ€§é¢æ¿ç»„ä»¶
  return <PropertiesPanel {...this._getPropertiesPanelProps()} />;
}
```

## ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ å¿«æ·é”®

åœ¨ `newIDE/app/src/MainFrame/Shortcuts.js` æˆ–ç±»ä¼¼æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```javascript
{
  shortcut: 'ctrl+b',
  description: 'åˆ‡æ¢å·¦ä¾§é¡¹ç›®å¯¼èˆªé¢æ¿',
  handler: () => {
    // è·å– MainFrame å®ä¾‹å¹¶åˆ‡æ¢å·¦ä¾§é¢æ¿
  },
},
{
  shortcut: 'ctrl+shift+b',
  description: 'åˆ‡æ¢å³ä¾§ç´ æé¢æ¿',
  handler: () => {
    // è·å– MainFrame å®ä¾‹å¹¶åˆ‡æ¢å³ä¾§é¢æ¿
  },
},
```

## ç¬¬å››æ­¥ï¼šæ·»åŠ èœå•é¡¹

### 4.1 ä¿®æ”¹é¡¹ç›®èœå•

åœ¨ `newIDE/app/src/MainFrame/ProjectMenu.js` ä¸­æ·»åŠ ï¼š

```javascript
menuItem({
  label: i18n._(
    t`Project Properties`
  ),
  click: () => {
    // æ‰“å¼€é¡¹ç›®å±æ€§å¯¹è¯æ¡†
    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ¸¸æˆç±»å‹ã€æ ‡ç­¾ç­‰ç¼–è¾‘åŠŸèƒ½
  },
}),
```

### 4.2 æ·»åŠ è§†å›¾èœå•

```javascript
menu.append(
  new MenuItem({
    label: i18n._(t`View`),
    submenu: [
      {
        label: i18n._(t`Project Navigation`),
        accelerator: 'Ctrl+B',
        click: () => {
          // åˆ‡æ¢å·¦ä¾§é¡¹ç›®å¯¼èˆªé¢æ¿
        },
      },
      {
        label: i18n._(t`Resource Panel`),
        accelerator: 'Ctrl+Shift+B',
        click: () => {
          // åˆ‡æ¢å³ä¾§ç´ æé¢æ¿
        },
      },
      { type: 'separator' },
      // ... å…¶ä»–è§†å›¾èœå•é¡¹ ...
    ],
  })
);
```

## ç¬¬äº”æ­¥ï¼šæ·»åŠ é¡¹ç›®å…ƒæ•°æ®å¯¹è¯æ¡†

åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è¯æ¡†ç»„ä»¶ç”¨äºç¼–è¾‘é¡¹ç›®å…ƒæ•°æ®ï¼š

```javascript
// newIDE/app/src/GameProjectManager/ProjectMetadata/MetadataDialog.js

import * as React from 'react';
import Dialog from '@material-ui/core/Dialog';
import DialogTitle from '@material-ui/core/DialogTitle';
import DialogContent from '@material-ui/core/DialogContent';
import DialogActions from '@material-ui/core/DialogActions';
import TextField from '@material-ui/core/TextField';
import Button from '@material-ui/core/Button';
import Select from '@material-ui/core/Select';
import MenuItem from '@material-ui/core/MenuItem';
import { GAME_TYPES } from '../constants';

type Props = {|
  project: ProjectMetadata,
  open: boolean,
  onClose: () => void,
  onSave: (metadata: ProjectMetadata) => void,
|};

const MetadataDialog = ({ project, open, onClose, onSave }: Props) => {
  const [name, setName] = React.useState(project.name);
  const [description, setDescription] = React.useState(project.description);
  const [gameType, setGameType] = React.useState(project.gameType);
  const [tags, setTags] = React.useState(project.tags.join(', '));

  const handleSave = () => {
    const updated = {
      ...project,
      name,
      description,
      gameType,
      tags: tags.split(',').map(t => t.trim()).filter(Boolean),
    };
    onSave(updated);
    onClose();
  };

  return (
    <Dialog open={open} onClose={onClose} maxWidth="sm" fullWidth>
      <DialogTitle>é¡¹ç›®å±æ€§</DialogTitle>
      <DialogContent>
        <TextField
          label="é¡¹ç›®åç§°"
          fullWidth
          margin="normal"
          value={name}
          onChange={e => setName(e.target.value)}
        />
        <TextField
          label="é¡¹ç›®æè¿°"
          fullWidth
          multiline
          rows={3}
          margin="normal"
          value={description}
          onChange={e => setDescription(e.target.value)}
        />
        <TextField
          select
          label="æ¸¸æˆç±»å‹"
          fullWidth
          margin="normal"
          value={gameType}
          onChange={e => setGameType(e.target.value)}
        >
          {Object.entries(GAME_TYPES).map(([type, config]) => (
            <MenuItem key={type} value={type}>
              {config.icon} {config.name}
            </MenuItem>
          ))}
        </TextField>
        <TextField
          label="æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰"
          fullWidth
          margin="normal"
          value={tags}
          onChange={e => setTags(e.target.value)}
          placeholder="ä¾‹å¦‚ï¼š2D, åƒç´ é£, å¹³å°è·³è·ƒ"
        />
      </DialogContent>
      <DialogActions>
        <Button onClick={onClose}>å–æ¶ˆ</Button>
        <Button onClick={handleSave} color="primary" variant="contained">
          ä¿å­˜
        </Button>
      </DialogActions>
    </Dialog>
  );
};

export default MetadataDialog;
```

## ç¬¬å…­æ­¥ï¼šæµ‹è¯•é›†æˆ

### 6.1 ç¼–è¯‘æ£€æŸ¥

```bash
cd newIDE/app
npm run flow-check
npm run lint
```

### 6.2 è¿è¡Œæµ‹è¯•

```bash
npm start
```

### 6.3 åŠŸèƒ½æµ‹è¯•æ¸…å•

- [ ] å·¦ä¾§é¡¹ç›®å¯¼èˆªé¢æ¿æ­£å¸¸æ˜¾ç¤º
- [ ] é¡¹ç›®å¯ä»¥æ­£å¸¸é€‰æ‹©å’Œæ‰“å¼€
- [ ] æ”¶è—åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] åˆ†ç±»å¯ä»¥æ­£å¸¸æ·»åŠ å’Œç¼–è¾‘
- [ ] å³ä¾§ç´ æé¢æ¿æ­£å¸¸æ˜¾ç¤º
- [ ] æ ‡ç­¾é¡µåˆ‡æ¢æ­£å¸¸
- [ ] ç­›é€‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] é¡¹ç›®å…ƒæ•°æ®æ­£å¸¸ä¿å­˜å’ŒåŠ è½½
- [ ] é¢æ¿åˆ‡æ¢åŠ¨ç”»æµç•…
- [ ] å¿«æ·é”®æ­£å¸¸å·¥ä½œ

## ç¬¬ä¸ƒæ­¥ï¼šå¯é€‰å¢å¼ºåŠŸèƒ½

### 7.1 æ·»åŠ é¡¹ç›®æ¨¡æ¿

```javascript
// åˆ›å»ºé¡¹ç›®æ¨¡æ¿åŠŸèƒ½
const createProjectFromTemplate = (templateId: string, projectName: string) => {
  // ä»æ¨¡æ¿åˆ›å»ºæ–°é¡¹ç›®
};
```

### 7.2 æ·»åŠ èµ„æºé¢„è§ˆ

```javascript
// åœ¨èµ„æºåˆ—è¡¨ä¸­æ·»åŠ é¢„è§ˆåŠŸèƒ½
const renderResourcePreview = (resource: Resource) => {
  // æ˜¾ç¤ºèµ„æºç¼©ç•¥å›¾
};
```

### 7.3 æ·»åŠ æ‹–æ‹½åŠŸèƒ½

```javascript
// ä½¿ç”¨ react-beautiful-dnd æ·»åŠ æ‹–æ‹½åŠŸèƒ½
import { DragDropContext, Droppable, Draggable } from 'react-beautiful-dnd';
```

## æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šç±»å‹æ£€æŸ¥é”™è¯¯

ç¡®ä¿æ‰€æœ‰ç±»å‹å®šä¹‰æ­£ç¡®å¯¼å…¥ï¼š
```javascript
import type { ProjectMetadata, Category } from '../GameProjectManager/types';
```

### é—®é¢˜2ï¼šç»„ä»¶æ¸²æŸ“é”™è¯¯

æ£€æŸ¥ Material-UI ç‰ˆæœ¬å…¼å®¹æ€§ï¼Œç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç»„ä»¶ APIã€‚

### é—®é¢˜3ï¼šçŠ¶æ€æ›´æ–°é—®é¢˜

ç¡®ä¿ä½¿ç”¨ `setState` çš„å›è°ƒå½¢å¼æ¥è®¿é—®æœ€æ–°çŠ¶æ€ï¼š
```javascript
this.setState(prevState => ({
  leftPanelOpen: !prevState.leftPanelOpen,
}));
```

## åç»­æ­¥éª¤

1. å®ŒæˆåŸºæœ¬é›†æˆåï¼Œæ ¹æ®å®é™…ä½¿ç”¨åé¦ˆè°ƒæ•´ç•Œé¢
2. æ·»åŠ æ›´å¤šè‡ªå®šä¹‰åˆ†ç±»å’Œæ ‡ç­¾
3. å®ç°äº‘åŒæ­¥åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰
4. ä¼˜åŒ–æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å¤§å‹é¡¹ç›®çš„å¤„ç†

## è·å–å¸®åŠ©

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æ£€æŸ¥ GDevelop ç‰ˆæœ¬å…¼å®¹æ€§
2. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
3. å‚è€ƒ GDevelop å®˜æ–¹æ–‡æ¡£
4. æ£€æŸ¥æœ¬é¡¹ç›®çš„ README å’Œå¿«é€Ÿå¼€å§‹æ–‡æ¡£
