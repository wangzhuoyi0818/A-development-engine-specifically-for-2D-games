# AutoDL éƒ¨ç½²å‘½ä»¤é›†åˆ
# åœ¨ AutoDL ç»ˆç«¯ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤

# ============================================
# ç¬¬ä¸€æ­¥ï¼šå®‰è£…ç¯å¢ƒ
# ============================================

# å®‰è£… Node.js
curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
apt install -y nodejs

# å®‰è£…éƒ¨ç½²å·¥å…·
npm install -g serve pm2

echo "âœ… ç¯å¢ƒå®‰è£…å®Œæˆ"

# ============================================
# ç¬¬äºŒæ­¥ï¼šåˆ›å»ºé¡¹ç›®ç›®å½•
# ============================================

mkdir -p /root/miniprogram

echo "âœ… ç›®å½•åˆ›å»ºå®Œæˆ"

# ============================================
# ç¬¬ä¸‰æ­¥ï¼šç­‰å¾…æ–‡ä»¶ä¸Šä¼ 
# ============================================
#
# âš ï¸ æš‚åœï¼è¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
# 1. æ‰“å¼€ AutoDL çš„ JupyterLab
# 2. å°† dist.tar.gz ä¸Šä¼ åˆ° /root/ ç›®å½•
# 3. ä¸Šä¼ å®Œæˆåç»§ç»­æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤
#

# ============================================
# ç¬¬å››æ­¥ï¼šè§£å‹æ–‡ä»¶
# ============================================

cd /root/miniprogram
tar -xzf /root/dist.tar.gz

# éªŒè¯æ–‡ä»¶
ls -la index.html

echo "âœ… æ–‡ä»¶è§£å‹å®Œæˆ"

# ============================================
# ç¬¬äº”æ­¥ï¼šå¯åŠ¨æœåŠ¡
# ============================================

pm2 delete miniprogram 2>/dev/null || true
pm2 serve /root/miniprogram 6006 --spa --name miniprogram
pm2 save
pm2 startup

echo ""
echo "========================================"
echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo "========================================"
echo ""

pm2 status

# ============================================
# ç¬¬å…­æ­¥ï¼šé…ç½®ç«¯å£æ˜ å°„
# ============================================
#
# âš ï¸ æœ€åä¸€æ­¥ï¼ˆåœ¨ AutoDL æ§åˆ¶å°æ“ä½œï¼‰ï¼š
# 1. æ‰“å¼€ https://www.autodl.com/console/instance/list
# 2. æ‰¾åˆ°ä½ çš„å®ä¾‹ï¼Œç‚¹å‡»"è‡ªå®šä¹‰æœåŠ¡"
# 3. æ·»åŠ ç«¯å£æ˜ å°„ï¼š
#    - å®¹å™¨ç«¯å£: 6006
#    - åè®®: HTTP
# 4. ä¿å­˜åä¼šç”Ÿæˆå…¬ç½‘è®¿é—®åœ°å€
#
# ğŸ‰ åœ¨æµè§ˆå™¨è¾“å…¥ç”Ÿæˆçš„åœ°å€å³å¯è®¿é—®ï¼

# ============================================
# å¸¸ç”¨ç®¡ç†å‘½ä»¤
# ============================================

# æŸ¥çœ‹çŠ¶æ€
# pm2 status

# æŸ¥çœ‹æ—¥å¿—
# pm2 logs miniprogram

# é‡å¯æœåŠ¡
# pm2 restart miniprogram

# åœæ­¢æœåŠ¡
# pm2 stop miniprogram
